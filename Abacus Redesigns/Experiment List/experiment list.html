<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B Testing Platform - Experiments</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-input: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f8f9fa;
            
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #495057;
            --text-light: #ffffff;
            
            --border-color: #e2e8f0;
            --border-light: #dee2e6;
            --border-medium: #cbd5e1;
            
            --shadow-light: 0 2px 12px rgba(0,0,0,0.06);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-card: 0 1px 4px rgba(0,0,0,0.05);
            
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --accent-orange: #f97316;
            --accent-cyan: #06b6d4;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-input: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-light: #ffffff;
            
            --border-color: #334155;
            --border-light: #475569;
            --border-medium: #64748b;
            
            --shadow-light: 0 2px 12px rgba(0,0,0,0.4);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.5);
            --shadow-card: 0 1px 4px rgba(0,0,0,0.3);
            
            --accent-blue: #60a5fa;
            --accent-blue-hover: #3b82f6;
            --accent-green: #34d399;
            --accent-yellow: #fbbf24;
            --accent-red: #f87171;
            --accent-purple: #a78bfa;
            --accent-orange: #fb923c;
            --accent-cyan: #22d3ee;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
            box-shadow: none;
        }

        .btn-primary:hover {
            background: var(--accent-blue-hover);
            transform: translateY(-2px);
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: rotate(10deg);
        }

        .theme-toggle .sun-icon {
            display: block;
        }

        .theme-toggle .moon-icon {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .moon-icon {
            display: block;
        }

        .filters-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .filters-section:hover {
            box-shadow: var(--shadow-medium);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .clear-filters {
            color: var(--accent-blue);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .clear-filters:hover {
            text-decoration: underline;
            transform: scale(1.05);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group.spaces-filter {
            grid-column: span 2;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .filter-select, .filter-input {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--accent-blue);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            animation: slideInUp 0.3s ease;
        }

        .filter-tag-remove {
            cursor: pointer;
            font-weight: bold;
            padding: 0 4px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }

        .filter-tag-remove:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Bubble tags container */
        .bubble-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .bubble-tag {
            display: inline-flex;
            align-items: center;
            background: var(--accent-blue);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
            white-space: nowrap;
        }

        .bubble-tag button {
            background: none;
            border: none;
            color: white;
            margin-left: 4px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bubble-tag button:hover {
            opacity: 0.8;
        }

        .results-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 16px 0;
        }

        .results-count {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .results-count strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .results-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .rows-per-page {
            display: flex;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .view-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: var(--shadow-card);
        }

        /* Calendar View Styles */
        .calendar-container {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: none;
            transition: all 0.3s ease;
        }

        .calendar-container.active {
            display: block;
        }

        .experiments-table.active {
            display: block;
        }

        .experiments-table:not(.active) {
            display: none;
        }

        .calendar-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .calendar-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calendar-scroll {
            overflow-x: auto;
            overflow-y: auto;
            position: relative;
            max-height: 600px;
            scrollbar-width: auto;
            -webkit-overflow-scrolling: touch;
        }

        .calendar-scroll::-webkit-scrollbar {
            height: 12px;
            width: 12px;
        }

        .calendar-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }

        .calendar-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }

        .calendar-scroll::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .calendar-content {
            display: flex;
            min-width: 1200px;
            position: relative;
        }

        .timeline-container {
            flex: 1;
            position: relative;
        }

        .timeline-header {
            display: flex;
            height: 40px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .month-header {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            border-right: 1px solid var(--border-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timeline-body {
            position: relative;
            min-height: 400px;
        }

        .day-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
        }

        .day-column {
            flex: 1;
            border-right: 1px solid rgba(226, 232, 240, 0.3);
        }

        .experiment-bar-row {
            height: 48px;
            border-bottom: 1px solid var(--border-light);
            position: relative;
        }

        .experiment-bar {
            position: absolute;
            height: 32px;
            top: 8px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: -0.3px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 1;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            line-height: 1.2;
        }

        .experiment-bar-icons {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .experiment-bar-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
            border-radius: 3px;
            padding: 2px;
        }

        .experiment-bar-text {
            display: flex;
            justify-content: space-between;
            width: 100%;
            overflow: hidden;
        }

        .experiment-bar-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 1;
            min-width: 0;
        }

        .experiment-bar-date {
            white-space: nowrap;
            flex-shrink: 0;
            padding-left: 12px;
            padding-right: 8px;
        }

        .experiment-bar:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 2;
        }

        /* Status-based colors matching List View badges */
        .experiment-bar.status-in-review {
            background: linear-gradient(135deg, var(--accent-orange) 0%, #ea580c 100%);
        }

        .experiment-bar.status-ready-to-start {
            background: linear-gradient(135deg, var(--accent-cyan) 0%, #0891b2 100%);
        }

        .experiment-bar.status-started {
            background: linear-gradient(135deg, var(--accent-green) 0%, #059669 100%);
        }

        .experiment-bar.status-ready-to-stop {
            background: linear-gradient(135deg, var(--accent-yellow) 0%, #d97706 100%);
        }

        .experiment-bar.status-ended {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
        }

        /* Legacy classes for backward compatibility */
        .experiment-bar.running {
            background: linear-gradient(135deg, var(--accent-green) 0%, #059669 100%);
        }

        .experiment-bar.ended {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
        }

        .experiment-bar.pending {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1565c0 100%);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        .tooltip.show {
            opacity: 1;
        }

        .stats {
            padding: 20px 24px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .today-marker {
            position: absolute;
            width: 2px;
            background: var(--accent-orange);
            top: 0;
            bottom: 0;
            z-index: 5;
            pointer-events: none;
        }

        .today-marker::before {
            content: 'TODAY';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-orange);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }

        .legend {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 24px;
            height: 12px;
            border-radius: 4px;
        }

        /* Status-based legend colors */
        .legend-color.status-in-review {
            background: var(--accent-orange);
        }

        .legend-color.status-ready-to-start {
            background: var(--accent-cyan);
        }

        .legend-color.status-started {
            background: var(--accent-green);
        }

        .legend-color.status-ready-to-stop {
            background: var(--accent-yellow);
        }

        .legend-color.status-ended {
            background: var(--accent-purple);
        }

        /* Legacy legend colors for backward compatibility */
        .legend-color.running {
            background: var(--accent-green);
        }

        .legend-color.ended {
            background: var(--accent-purple);
        }

        .legend-color.pending {
            background: var(--accent-blue);
        }

        .calendar-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .today-button {
            padding: 8px 16px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .today-button:hover {
            background: var(--accent-blue-hover);
        }

        .today-button:active {
            transform: scale(0.98);
        }

        .platform-filters {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .filter-checkbox span {
            font-size: 13px;
            color: var(--text-primary);
            user-select: none;
        }

        .experiments-table {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .experiments-table:hover {
            box-shadow: var(--shadow-medium);
        }

        .table-header {
            background: var(--bg-secondary);
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px 24px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: all 0.2s ease;
        }

        th:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        th.sortable {
            padding-right: 40px;
        }

        .sort-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        th:hover .sort-icon {
            opacity: 1;
        }

        th.sort-asc .sort-icon {
            opacity: 1;
            transform: translateY(-50%) rotate(180deg);
        }

        th.sort-desc .sort-icon {
            opacity: 1;
            transform: translateY(-50%) rotate(0deg);
        }

        td {
            color: var(--text-primary);
        }

        .experiment-row {
            transition: all 0.2s ease;
            animation: fadeInUp 0.5s ease;
        }

        .experiment-row:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .experiment-row.highlighted {
            background: rgba(59, 130, 246, 0.08);
            border-left: 4px solid var(--accent-blue);
        }

        .experiment-name {
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .experiment-name:hover {
            color: var(--accent-blue);
        }

        .test-id {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .submitter {
            color: var(--text-secondary);
        }

        .space-tag {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }

        .status-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: capitalize;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            line-height: 1; /* Add this */
        }

        .status-platform {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            font-weight: 700;
            line-height: 1; /* Add this */
            display: flex; /* Add this */
            align-items: center; /* Add this */
        }
 
        .status-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .status-badge:hover::before {
            left: 100%;
        }

        .status-in-review {
            background: var(--accent-orange);
            color: white;
        }

        .status-ready-to-start {
            background: var(--accent-cyan);
            color: white;
        }

        .status-started {
            background: var(--accent-green);
            color: white;
        }

        .status-ready-to-stop {
            background: var(--accent-yellow);
            color: white;
        }

        .status-ended {
            background: var(--accent-purple);
            color: white;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            padding: 20px 0;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .pagination .rows-per-page {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .page-btn:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .page-btn.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .results-summary {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .results-controls {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .experiments-table {
                overflow-x: auto;
            }

            table {
                min-width: 900px;
            }

            th, td {
                padding: 12px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>Experiments</h1>
                <p class="header-subtitle">Manage and monitor your A/B tests</p>
            </div>
            <div class="header-right">
                <button class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    New Experiment
                </button>
                <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                    <svg class="sun-icon" width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
                    </svg>
                    <svg class="moon-icon" width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-header">
                <h3 class="filters-title">Filters</h3>
                <a href="#" class="clear-filters">Clear all</a>
            </div>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Platform</label>
                    <div class="platform-filters">
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filter-web" checked>
                            <span>Web</span>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filter-ios" checked>
                            <span>iOS</span>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filter-android" checked>
                            <span>Android</span>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="filter-select" id="status-filter">
                        <option value="">All Statuses</option>
                        <option value="in-review">In Review</option>
                        <option value="ready-to-start">Ready To Start</option>
                        <option value="started">Started</option>
                        <option value="ready-to-stop">Ready to Stop</option>
                        <option value="ended">Ended</option>
                    </select>
                </div>

                <div class="filter-group spaces-filter">
                    <label class="filter-label">Spaces</label>
                    <div class="multi-select-container" style="margin-bottom: 8px;">
                        <select class="filter-select" id="spaces-select" onchange="addSpace(this.value); this.value='';">
                            <option value="">All Spaces</option>
                            <option value="home">Home</option>
                            <option value="search-space">Search Space</option>
                            <option value="cart">Cart</option>
                            <option value="boost">Boost</option>
                            <option value="checkout">Checkout</option>
                            <option value="coupons">Coupons</option>
                        </select>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Date From</label>
                    <input type="date" class="filter-input" id="date-from" value="2024-01-01">
                </div>

                <div class="filter-group">
                    <label class="filter-label">Date To</label>
                    <input type="date" class="filter-input" id="date-to" value="2025-12-31">
                </div>
            </div>

            <div class="bubble-tags-container" id="active-filters" style="min-height: 24px; padding: 4px; border-radius: 4px;">
                <!-- Selected spaces will appear here as bubble tags -->
            </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
            <div class="results-count">
                Showing <strong id="results-count">24</strong> experiments
            </div>
            <div class="results-controls">
                <button class="today-button" id="go-to-today-btn" title="Scroll to today's date" style="display: none;">
                    📅 Go to Today
                </button>
                <div class="view-toggle">
                    <button class="view-btn active" id="list-view-btn" data-view="list">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        List View
                    </button>
                    <button class="view-btn" id="calendar-view-btn" data-view="calendar">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                        </svg>
                        Calendar View
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar Legend (shown below calendar view) -->
        <div class="calendar-controls" id="calendar-controls" style="display: none;">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color status-in-review"></div>
                    <span>In Review</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color status-ready-to-start"></div>
                    <span>Ready To Start</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color status-started"></div>
                    <span>Started</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color status-ready-to-stop"></div>
                    <span>Ready to Stop</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color status-ended"></div>
                    <span>Ended</span>
                </div>
            </div>
        </div>

        <!-- Experiments Table -->
        <div class="experiments-table active" id="list-view-container">
            <div class="table-header">
                <h3>Active Experiments</h3>
            </div>

            <table>
                <thead>
                    <tr>
                        <th class="sortable" data-column="name">
                            Experiment Name
                            <svg class="sort-icon" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.5 6.5A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1zm0 3A.5.5 0 0 1 4 9h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1z"/>
                            </svg>
                        </th>
                        <th class="sortable" data-column="testId">
                            Test ID
                            <svg class="sort-icon" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.5 6.5A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1zm0 3A.5.5 0 0 1 4 9h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1z"/>
                            </svg>
                        </th>
                        <th class="sortable" data-column="owner">
                            Owner
                            <svg class="sort-icon" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.5 6.5A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1zm0 3A.5.5 0 0 1 4 9h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1z"/>
                            </svg>
                        </th>
                        <th class="sortable" data-column="Status">
                            Status
                            <svg class="sort-icon" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.5 6.5A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1zm0 3A.5.5 0 0 1 4 9h8a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5v-1z"/>
                            </svg>
                        </th>
                        <th>Spaces</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="experiments-tbody">
                    <tr class="experiment-row highlighted" data-name="Homepage Hero Banner Optimization" data-testid="hb2a8c" data-owner="Sarah Chen" data-spaces="home">
                        <td>
                            <div class="experiment-name">Homepage Hero Banner Optimization</div>
                        </td>
                        <td>
                            <span class="test-id">hb2a8c</span>
                        </td>
                        <td>
                            <span class="submitter">Sarah Chen</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-started">
                                    <span class="status-platform">Web</span>
                                    Started
                                </span>
                                <span class="status-badge status-ready-to-start">
                                    <span class="status-platform">iOS</span>
                                    Ready To Start
                                </span>
                                <span class="status-badge status-ended">
                                    <span class="status-platform">Android</span>
                                    Ended
                                </span>
                            </div>
                        </td>
                        <td>
                            <span class="space-tag">Home</span>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="experiment-row" data-name="Product Page Checkout Flow" data-testid="pp4f9d" data-owner="Marcus Rodriguez" data-spaces="checkout">
                        <td>
                            <div class="experiment-name">Product Page Checkout Flow</div>
                        </td>
                        <td>
                            <span class="test-id">pp4f9d</span>
                        </td>
                        <td>
                            <span class="submitter">Marcus Rodriguez</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-started">
                                    <span class="status-platform">Web</span>
                                    Started
                                </span>
                                <span class="status-badge status-started">
                                    <span class="status-platform">iOS</span>
                                    Started
                                </span>
                                <span class="status-badge status-ready-to-start">
                                    <span class="status-platform">Android</span>
                                    Ready To Start
                                </span>
                            </div>
                        </td>
                        <td>
                            <span class="space-tag">Checkout</span>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="experiment-row" data-name="Mobile Navigation Redesign" data-testid="mn7e2k" data-owner="Emma Thompson" data-spaces="home">
                        <td>
                            <div class="experiment-name">Mobile Navigation Redesign</div>
                        </td>
                        <td>
                            <span class="test-id">mn7e2k</span>
                        </td>
                        <td>
                            <span class="submitter">Emma Thompson</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-ready-to-start">
                                    <span class="status-platform">Web</span>
                                    Ready To Start
                                </span>
                                <span class="status-badge status-in-review">
                                    <span class="status-platform">iOS</span>
                                    In Review
                                </span>
                                <span class="status-badge status-ended">
                                    <span class="status-platform">Android</span>
                                    Ended
                                </span>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <span class="space-tag">Home</span>
                                <span class="space-tag">Search Space</span>
                            </div>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="experiment-row" data-name="Email Campaign Personalization" data-testid="ec9x4v" data-owner="David Park" data-spaces="coupons">
                        <td>
                            <div class="experiment-name">Email Campaign Personalization</div>
                        </td>
                        <td>
                            <span class="test-id">ec9x4v</span>
                        </td>
                        <td>
                            <span class="submitter">David Park</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-started">
                                    <span class="status-platform">Web</span>
                                    Started
                                </span>
                                <span class="status-badge status-ready-to-stop">
                                    <span class="status-platform">iOS</span>
                                    Ready to Stop
                                </span>
                                <span class="status-badge status-ended">
                                    <span class="status-platform">Android</span>
                                    Ended
                                </span>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <span class="space-tag">Coupons</span>
                                <span class="space-tag">Boost</span>
                            </div>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="experiment-row" data-name="Search Results Algorithm V2" data-testid="sr1m6h" data-owner="Lisa Wang" data-spaces="search-space">
                        <td>
                            <div class="experiment-name">Search Results Algorithm V2</div>
                        </td>
                        <td>
                            <span class="test-id">sr1m6h</span>
                        </td>
                        <td>
                            <span class="submitter">Lisa Wang</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-ended">
                                    <span class="status-platform">Web</span>
                                    Ended
                                </span>
                                <span class="status-badge status-ended">
                                    <span class="status-platform">iOS</span>
                                    Ended
                                </span>
                                <span class="status-badge status-ended">
                                    <span class="status-platform">Android</span>
                                    Ended
                                </span>
                            </div>
                        </td>
                        <td>
                            <span class="space-tag">Search Space</span>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="experiment-row" data-name="Pricing Page Layout Test" data-testid="pp3n8j" data-owner="Alex Johnson" data-spaces="cart,checkout">
                        <td>
                            <div class="experiment-name">Pricing Page Layout Test</div>
                        </td>
                        <td>
                            <span class="test-id">pp3n8j</span>
                        </td>
                        <td>
                            <span class="submitter">Alex Johnson</span>
                        </td>
                        <td>
                            <div class="status-badges">
                                <span class="status-badge status-in-review">
                                    <span class="status-platform">Web</span>
                                    In Review
                                </span>
                                <span class="status-badge status-in-review">
                                    <span class="status-platform">iOS</span>
                                    In Review
                                </span>
                                <span class="status-badge status-in-review">
                                    <span class="status-platform">Android</span>
                                    In Review
                                </span>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <span class="space-tag">Cart</span>
                                <span class="space-tag">Checkout</span>
                            </div>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" title="Duplicate">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination-container">
            <div class="rows-per-page" id="rows-per-page-control">
                <label class="filter-label">Rows per page:</label>
                <select class="filter-select" id="rows-per-page" style="width: auto;">
                    <option value="10">10</option>
                    <option value="15" selected>15</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="pagination-controls">
                <button class="page-btn" disabled>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 6L8.5 3l-3 3L6 6.5l2.5-2.5L11 6.5z"/>
                    </svg>
                </button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <span>...</span>
                <button class="page-btn">8</button>
                <button class="page-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zm3.5 6L8.5 9l-3-3L6 6.5l2.5 2.5L11 6.5z"/>
                    </svg>
                </button>
            </div>
            <div style="width: 150px;"></div> <!-- Spacer for balance -->
        </div>

        <!-- Calendar View Container -->
        <div class="calendar-container" id="calendar-view-container">
            <div class="calendar-header">
                <h3>Experiment Timeline</h3>
            </div>

            <div class="calendar-scroll">
                <div class="calendar-content">
                    <div class="timeline-container">
                        <div class="timeline-header" id="timelineHeader">
                            <!-- Month headers will be generated here -->
                        </div>
                        <div class="timeline-body" id="timelineBody">
                            <div class="day-grid" id="dayGrid">
                                <!-- Day columns will be generated here -->
                            </div>
                            <div id="experimentBars">
                                <!-- Experiment bars will be generated here -->
                            </div>
                            <div class="today-marker" id="todayMarker"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalExperiments">0</div>
                    <div class="stat-label">Total Experiments</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="runningCount">0</div>
                    <div class="stat-label">Currently Running</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="endedCount">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pendingCount">0</div>
                    <div class="stat-label">Not Started</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip for calendar view -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Global state
        let currentTheme = 'light';
        let currentSort = { column: null, direction: null };
        let currentView = 'list';
        let viewStartDate, viewEndDate, totalDays;
        let hasAutoScrolled = false;
        const tooltip = document.getElementById('tooltip');

        // List View experiment data structure (from experiment-list-bkp.html)
        const listViewExperiments = [
            {
                id: 'exp001',
                name: 'Homepage Hero Banner Optimization',
                testId: 'hb2a8c',
                owner: 'Sarah Chen',
                startDate: '2025-01-15',
                endDate: '2025-02-15',
                spaces: ['home'],
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'ready-to-start' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'exp002',
                name: 'Product Page Checkout Flow',
                testId: 'pp4f9d',
                owner: 'Marcus Rodriguez',
                startDate: '2025-01-20',
                endDate: '2025-03-10',
                spaces: ['checkout'],
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'started' },
                    { platform: 'Android', status: 'ready-to-start' }
                ]
            },
            {
                id: 'exp003',
                name: 'Mobile Navigation Redesign',
                testId: 'mn7e2k',
                owner: 'Emma Thompson',
                startDate: '2025-02-01',
                endDate: '2025-02-28',
                spaces: ['home', 'search-space'],
                platforms: [
                    { platform: 'Web', status: 'ready-to-start' },
                    { platform: 'iOS', status: 'in-review' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'exp004',
                name: 'Email Campaign Personalization',
                testId: 'ec9x4v',
                owner: 'David Park',
                startDate: '2025-01-10',
                endDate: '2025-01-31',
                spaces: ['coupons', 'boost'],
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'ready-to-stop' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'exp005',
                name: 'Search Results Algorithm V2',
                testId: 'sr1m6h',
                owner: 'Lisa Wang',
                startDate: '2024-12-01',
                endDate: '2024-12-31',
                spaces: ['search-space'],
                platforms: [
                    { platform: 'Web', status: 'ended' },
                    { platform: 'iOS', status: 'ended' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'exp006',
                name: 'Pricing Page Layout Test',
                testId: 'pp3n8j',
                owner: 'Alex Johnson',
                startDate: '2025-03-05',
                endDate: '2025-04-05',
                spaces: ['cart', 'checkout'],
                platforms: [
                    { platform: 'Web', status: 'in-review' },
                    { platform: 'iOS', status: 'in-review' },
                    { platform: 'Android', status: 'in-review' }
                ]
            }
        ];

        // Calendar View experiment data structure (from ab-test-calendar-view.html)
        const calendarViewExperiments = [
            {
                id: 'cal001',
                name: 'Home Page Hero Banner Test',
                startDate: '2025-01-15',
                endDate: '2025-02-15',
                platforms: [
                    { platform: 'Web', status: 'ended' }
                ]
            },
            {
                id: 'cal002',
                name: 'One-Click Add to Cart',
                startDate: '2025-01-20',
                endDate: '2025-03-10',
                platforms: [
                    { platform: 'iOS', status: 'started' }
                ]
            },
            {
                id: 'cal003',
                name: 'Search Results Optimization',
                startDate: '2025-02-01',
                endDate: '2025-03-03',
                platforms: [
                    { platform: 'Web', status: 'started' }
                ]
            },
            {
                id: 'cal004',
                name: 'Checkout Flow Redesign',
                startDate: '2025-01-10',
                endDate: '2025-02-09',
                platforms: [
                    { platform: 'Web', status: 'ended' },
                    { platform: 'iOS', status: 'ended' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'cal005',
                name: 'Product Recommendations',
                startDate: '2025-03-05',
                endDate: '2025-04-05',
                platforms: [
                    { platform: 'Web', status: 'in-review' }
                ]
            },
            {
                id: 'cal006',
                name: 'Mobile Navigation Test',
                startDate: '2025-01-25',
                endDate: '2025-02-24',
                platforms: [
                    { platform: 'Android', status: 'started' }
                ]
            },
            {
                id: 'cal007',
                name: 'Email Template A/B Test',
                startDate: '2025-03-10',
                endDate: '2025-04-09',
                platforms: [
                    { platform: 'Web', status: 'in-review' }
                ]
            },
            {
                id: 'cal008',
                name: 'Cart Abandonment Flow',
                startDate: '2025-02-10',
                endDate: '2025-03-12',
                platforms: [
                    { platform: 'Web', status: 'started' }
                ]
            },
            {
                id: 'cal009',
                name: 'Category Page Layout',
                startDate: '2025-01-05',
                endDate: '2025-02-04',
                platforms: [
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'cal010',
                name: 'Push Notification Timing',
                startDate: '2025-02-20',
                endDate: '2025-03-22',
                platforms: [
                    { platform: 'iOS', status: 'started' }
                ]
            },
            {
                id: 'cal011',
                name: 'Loyalty Program Redesign',
                startDate: '2025-03-15',
                endDate: '2025-04-15',
                platforms: [
                    { platform: 'Web', status: 'in-review' },
                    { platform: 'iOS', status: 'in-review' },
                    { platform: 'Android', status: 'in-review' }
                ]
            },
            {
                id: 'cal012',
                name: 'Payment Methods A/B',
                startDate: '2025-02-05',
                endDate: '2025-03-07',
                platforms: [
                    { platform: 'iOS', status: 'started' }
                ]
            },
            {
                id: 'cal013',
                name: 'Homepage Personalization',
                startDate: '2025-01-28',
                endDate: '2025-02-27',
                platforms: [
                    { platform: 'Web', status: 'started' }
                ]
            },
            {
                id: 'cal014',
                name: 'Quick View Feature',
                startDate: '2025-03-20',
                endDate: '2025-04-20',
                platforms: [
                    { platform: 'Android', status: 'in-review' }
                ]
            },
            {
                id: 'cal015',
                name: 'Reviews Display Test',
                startDate: '2025-02-15',
                endDate: '2025-03-17',
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'started' },
                    { platform: 'Android', status: 'started' }
                ]
            },
            {
                id: 'cal016',
                name: 'Summer Promo Campaign',
                startDate: '2024-07-01',
                endDate: '2024-07-31',
                platforms: [
                    { platform: 'Web', status: 'ended' }
                ]
            },
            {
                id: 'cal017',
                name: 'Back to School Sale',
                startDate: '2024-08-01',
                endDate: '2024-08-31',
                platforms: [
                    { platform: 'Web', status: 'ended' },
                    { platform: 'iOS', status: 'ended' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            // New experiments around September 2025 for better visual testing
            {
                id: 'cal018',
                name: 'Winter Sale Banner Test',
                startDate: '2025-08-15',
                endDate: '2025-09-15',
                platforms: [
                    { platform: 'Web', status: 'ended' },
                    { platform: 'iOS', status: 'ended' }
                ]
            },
            {
                id: 'cal019',
                name: 'Mobile Checkout Optimization',
                startDate: '2025-09-10',
                endDate: '2025-10-10',
                platforms: [
                    { platform: 'iOS', status: 'started' },
                    { platform: 'Android', status: 'started' }
                ]
            },
            {
                id: 'cal020',
                name: 'Product Grid Layout V2',
                startDate: '2025-09-20',
                endDate: '2025-10-20',
                platforms: [
                    { platform: 'Web', status: 'ready-to-stop' }
                ]
            },
            {
                id: 'cal021',
                name: 'New Year Promo Campaign',
                startDate: '2025-08-20',
                endDate: '2025-09-19',
                platforms: [
                    { platform: 'Web', status: 'ended' },
                    { platform: 'iOS', status: 'ended' },
                    { platform: 'Android', status: 'ended' }
                ]
            },
            {
                id: 'cal022',
                name: 'Search Autocomplete Enhancement',
                startDate: '2025-09-15',
                endDate: '2025-10-23',
                platforms: [
                    { platform: 'Web', status: 'started' }
                ]
            },
            {
                id: 'cal023',
                name: 'Cart Upsell Widget Test',
                startDate: '2025-09-22',
                endDate: '2025-10-22',
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal024',
                name: 'Valentine\'s Day Landing Page',
                startDate: '2025-09-28',
                endDate: '2025-10-28',
                platforms: [
                    { platform: 'Web', status: 'in-review' },
                    { platform: 'iOS', status: 'in-review' }
                ]
            },
            {
                id: 'cal025',
                name: 'Wishlist Feature Redesign',
                startDate: '2025-09-18',
                endDate: '2025-11-02',
                platforms: [
                    { platform: 'iOS', status: 'started' },
                    { platform: 'Android', status: 'started' }
                ]
            },
            {
                id: 'cal026',
                name: 'Boost Recommendations Algorithm',
                startDate: '2025-09-12',
                endDate: '2025-10-12',
                platforms: [
                    { platform: 'Web', status: 'ready-to-stop' },
                    { platform: 'Android', status: 'started' }
                ]
            },
            {
                id: 'cal027',
                name: 'Coupon Code Entry Optimization',
                startDate: '2025-08-25',
                endDate: '2025-09-24',
                platforms: [
                    { platform: 'Web', status: 'ended' }
                ]
            },
            {
                id: 'cal028',
                name: 'Product Image Zoom Feature',
                startDate: '2025-09-26',
                endDate: '2025-10-27',
                platforms: [
                    { platform: 'Web', status: 'in-review' }
                ]
            },
            {
                id: 'cal029',
                name: 'Express Checkout Flow',
                startDate: '2025-09-14',
                endDate: '2025-10-29',
                platforms: [
                    { platform: 'Web', status: 'started' },
                    { platform: 'iOS', status: 'started' },
                    { platform: 'Android', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal030',
                name: 'Homepage Personalization V3',
                startDate: '2025-10-01',
                endDate: '2025-10-31',
                platforms: [
                    { platform: 'Web', status: 'in-review' },
                    { platform: 'iOS', status: 'in-review' },
                    { platform: 'Android', status: 'in-review' }
                ]
            },
            {
                id: 'cal031',
                name: 'Social Share Buttons Test',
                startDate: '2025-09-24',
                endDate: '2025-10-24',
                platforms: [
                    { platform: 'Web', status: 'ready-to-stop' }
                ]
            },
            {
                id: 'cal032',
                name: 'Live Chat Widget Placement',
                startDate: '2025-09-16',
                endDate: '2025-10-17',
                platforms: [
                    { platform: 'Web', status: 'started' }
                ]
            },
            // New experiments with "Ready To Start" status around today (Sept 30, 2025)
            {
                id: 'cal033',
                name: 'Personalized Product Recommendations',
                startDate: '2025-09-25',
                endDate: '2025-10-25',
                platforms: [
                    { platform: 'Web', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal034',
                name: 'Mobile App Onboarding Flow',
                startDate: '2025-09-27',
                endDate: '2025-10-27',
                platforms: [
                    { platform: 'iOS', status: 'ready-to-start' },
                    { platform: 'Android', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal035',
                name: 'Smart Search Filters',
                startDate: '2025-09-29',
                endDate: '2025-10-29',
                platforms: [
                    { platform: 'Web', status: 'ready-to-start' },
                    { platform: 'iOS', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal036',
                name: 'Quick Reorder Feature',
                startDate: '2025-10-01',
                endDate: '2025-10-31',
                platforms: [
                    { platform: 'Android', status: 'ready-to-start' }
                ]
            },
            {
                id: 'cal037',
                name: 'Enhanced Product Details Page',
                startDate: '2025-09-28',
                endDate: '2025-10-28',
                platforms: [
                    { platform: 'Web', status: 'ready-to-start' },
                    { platform: 'iOS', status: 'ready-to-start' },
                    { platform: 'Android', status: 'ready-to-start' }
                ]
            }
        ];

        function init() {
            setupThemeToggle();
            setupFilters();
            setupSorting();
            setupViewToggle();
            renderListView();
            updateResultsCount();
        }

        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');

            themeToggle.addEventListener('click', () => {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', currentTheme);
            });
        }

        function setupFilters() {
            // Platform checkboxes
            document.getElementById('filter-web').addEventListener('change', applyFilters);
            document.getElementById('filter-ios').addEventListener('change', applyFilters);
            document.getElementById('filter-android').addEventListener('change', applyFilters);

            // Filter selects
            const filterSelects = document.querySelectorAll('.filter-select');
            filterSelects.forEach(select => {
                select.addEventListener('change', applyFilters);
            });

            // Date inputs
            const filterInputs = document.querySelectorAll('.filter-input');
            filterInputs.forEach(input => {
                input.addEventListener('change', applyFilters);
            });

            // Rows per page
            const rowsPerPage = document.getElementById('rows-per-page');
            if (rowsPerPage) {
                rowsPerPage.addEventListener('change', applyFilters);
            }

            // Clear all filters
            const clearFilters = document.querySelector('.clear-filters');
            clearFilters.addEventListener('click', (e) => {
                e.preventDefault();
                // Clear space selections
                selectedSpaces = [];
                renderSpacesBubbleTags();
                // Clear other filters
                document.querySelectorAll('.filter-select').forEach(select => select.selectedIndex = 0);
                document.getElementById('filter-web').checked = true;
                document.getElementById('filter-ios').checked = true;
                document.getElementById('filter-android').checked = true;
                applyFilters();
            });
        }

        // Track selected spaces
        let selectedSpaces = [];

        // Create bubble tag element for spaces
        function createBubbleTag(text, onRemove) {
            return `
                <span class="bubble-tag">
                    ${text}
                    <button type="button" onclick="${onRemove}">×</button>
                </span>
            `;
        }

        // Add space to selected spaces
        function addSpace(space) {
            if (space && !selectedSpaces.includes(space)) {
                selectedSpaces.push(space);
                renderSpacesBubbleTags();
                applyFilters();
            }
        }

        // Remove space from selected spaces
        function removeSpace(space) {
            selectedSpaces = selectedSpaces.filter(s => s !== space);
            renderSpacesBubbleTags();
            applyFilters();
        }

        // Render spaces bubble tags
        function renderSpacesBubbleTags() {
            const spacesTagsContainer = document.getElementById('active-filters');
            if (spacesTagsContainer) {
                const spaceTags = selectedSpaces.map(space => {
                    // Convert space value to display name
                    const displayName = getSpaceDisplayName(space);
                    return createBubbleTag(displayName, `removeSpace('${space}')`);
                }).join('');
                spacesTagsContainer.innerHTML = spaceTags;
            }
        }

        // Convert space value to display name
        function getSpaceDisplayName(value) {
            const spaceNames = {
                'home': 'Home',
                'search-space': 'Search Space',
                'cart': 'Cart',
                'boost': 'Boost',
                'checkout': 'Checkout',
                'coupons': 'Coupons'
            };
            return spaceNames[value] || value;
        }

        // Get selected spaces array
        function getSelectedSpaces() {
            return selectedSpaces;
        }

        function setupSorting() {
            const sortableHeaders = document.querySelectorAll('th.sortable');

            sortableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const column = header.dataset.column;
                    let direction = 'asc';

                    // If clicking the same column, toggle direction
                    if (currentSort.column === column) {
                        direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    }

                    // Update sort state
                    currentSort = { column, direction };

                    // Update header classes
                    sortableHeaders.forEach(h => {
                        h.classList.remove('sort-asc', 'sort-desc');
                    });
                    header.classList.add(`sort-${direction}`);

                    // Sort the table
                    sortTable(column, direction);
                });
            });
        }

        function setupViewToggle() {
            const listViewBtn = document.getElementById('list-view-btn');
            const calendarViewBtn = document.getElementById('calendar-view-btn');
            const goToTodayBtn = document.getElementById('go-to-today-btn');

            listViewBtn.addEventListener('click', () => switchView('list'));
            calendarViewBtn.addEventListener('click', () => switchView('calendar'));
            goToTodayBtn.addEventListener('click', scrollToToday);
        }

        function switchView(view) {
            currentView = view;

            const listViewBtn = document.getElementById('list-view-btn');
            const calendarViewBtn = document.getElementById('calendar-view-btn');
            const listContainer = document.getElementById('list-view-container');
            const calendarContainer = document.getElementById('calendar-view-container');
            const paginationContainer = document.getElementById('pagination-container');
            const rowsPerPageControl = document.getElementById('rows-per-page-control');
            const goToTodayBtn = document.getElementById('go-to-today-btn');
            const calendarControls = document.getElementById('calendar-controls');

            if (view === 'list') {
                listViewBtn.classList.add('active');
                calendarViewBtn.classList.remove('active');
                listContainer.classList.add('active');
                calendarContainer.classList.remove('active');
                paginationContainer.style.display = 'flex';
                rowsPerPageControl.style.display = 'flex';
                goToTodayBtn.style.display = 'none';
                calendarControls.style.display = 'none';
                renderListView();
            } else {
                listViewBtn.classList.remove('active');
                calendarViewBtn.classList.add('active');
                listContainer.classList.remove('active');
                calendarContainer.classList.add('active');
                paginationContainer.style.display = 'none';
                rowsPerPageControl.style.display = 'none';
                goToTodayBtn.style.display = 'block';
                calendarControls.style.display = 'flex';
                initCalendar();

                // Auto-scroll to today's date when switching to calendar view
                setTimeout(() => {
                    scrollToToday();
                }, 100);
            }
        }

        function getFilteredExperiments() {
            const webChecked = document.getElementById('filter-web').checked;
            const iosChecked = document.getElementById('filter-ios').checked;
            const androidChecked = document.getElementById('filter-android').checked;
            const statusFilter = document.getElementById('status-filter').value;
            const selectedSpaces = getSelectedSpaces();
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;

            // Use appropriate dataset based on current view
            const sourceData = currentView === 'calendar' ? calendarViewExperiments : listViewExperiments;

            return sourceData.filter(exp => {
                // Platform filter
                const platformMatch = exp.platforms.some(p => {
                    if (p.platform === 'Web' && webChecked) return true;
                    if (p.platform === 'iOS' && iosChecked) return true;
                    if (p.platform === 'Android' && androidChecked) return true;
                    return false;
                });
                if (!platformMatch) return false;

                // Status filter
                if (statusFilter) {
                    const statusMatch = exp.platforms.some(p => p.status === statusFilter);
                    if (!statusMatch) return false;
                }

                // Spaces filter (only for list view) - multi-select
                if (selectedSpaces.length > 0 && currentView === 'list') {
                    if (!exp.spaces || !exp.spaces.some(space => selectedSpaces.includes(space))) {
                        return false;
                    }
                }

                // Date filter
                if (dateFrom && exp.endDate < dateFrom) return false;
                if (dateTo && exp.startDate > dateTo) return false;

                return true;
            });
        }

        function applyFilters() {
            updateResultsCount();
            if (currentView === 'list') {
                renderListView();
            } else {
                renderCalendarExperiments();
                updateCalendarStats();
            }
        }

        function updateResultsCount() {
            const filtered = getFilteredExperiments();
            document.getElementById('results-count').textContent = filtered.length;
        }

        function renderListView() {
            const tbody = document.getElementById('experiments-tbody');
            let filtered = getFilteredExperiments();

            // Sort by name by default if no sort is applied
            if (!currentSort.column) {
                filtered = filtered.sort((a, b) => a.name.localeCompare(b.name));
            }

            tbody.innerHTML = '';

            filtered.forEach(exp => {
                const row = document.createElement('tr');
                row.className = 'experiment-row';
                row.dataset.name = exp.name;
                row.dataset.testid = exp.testId;
                row.dataset.owner = exp.owner;
                row.dataset.spaces = exp.spaces.join(',');

                // Status badges
                const statusBadges = exp.platforms.map(p => {
                    const statusClass = `status-${p.status}`;
                    return `<span class="status-badge ${statusClass}">
                        <span class="status-platform">${p.platform}</span>
                        ${p.status.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                    </span>`;
                }).join('');

                // Space tags
                const spaceTags = exp.spaces.map(s =>
                    `<span class="space-tag">${s.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}</span>`
                ).join('');

                row.innerHTML = `
                    <td><div class="experiment-name">${exp.name}</div></td>
                    <td><span class="test-id">${exp.testId}</span></td>
                    <td><span class="submitter">${exp.owner}</span></td>
                    <td><div class="status-badges">${statusBadges}</div></td>
                    <td><div style="display: flex; gap: 4px; flex-wrap: wrap;">${spaceTags}</div></td>
                    <td>
                        <div class="actions">
                            <button class="action-btn" title="Duplicate">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        function sortTable(column, direction) {
            const tbody = document.getElementById('experiments-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                let aValue, bValue;

                switch (column) {
                    case 'name':
                        aValue = a.dataset.name.toLowerCase();
                        bValue = b.dataset.name.toLowerCase();
                        break;
                    case 'testId':
                        aValue = a.dataset.testid.toLowerCase();
                        bValue = b.dataset.testid.toLowerCase();
                        break;
                    case 'owner':
                        aValue = a.dataset.owner.toLowerCase();
                        bValue = b.dataset.owner.toLowerCase();
                        break;
                    case 'spaces':
                        aValue = a.dataset.spaces.toLowerCase();
                        bValue = b.dataset.spaces.toLowerCase();
                        break;
                    default:
                        return 0;
                }

                if (direction === 'asc') {
                    return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                } else {
                    return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                }
            });

            // Clear tbody and append sorted rows
            tbody.innerHTML = '';
            rows.forEach(row => {
                row.style.opacity = '0';
                tbody.appendChild(row);

                setTimeout(() => {
                    row.style.transition = 'opacity 0.3s ease';
                    row.style.opacity = '1';
                }, 50);
            });
        }

        // Calendar View Functions
        function initCalendar() {
            const dateFrom = document.getElementById('date-from');
            const dateTo = document.getElementById('date-to');

            if (!dateFrom.value || !dateTo.value) {
                dateFrom.value = '2024-01-01';
                dateTo.value = '2025-12-31';
            }

            viewStartDate = new Date(dateFrom.value);
            viewEndDate = new Date(dateTo.value);
            totalDays = Math.ceil((viewEndDate - viewStartDate) / (1000 * 60 * 60 * 24)) + 1;

            renderTimeline();
            renderCalendarExperiments();
            updateCalendarStats();
            positionTodayMarker();

            if (!hasAutoScrolled) {
                scrollToStart();
            }
        }

        function scrollToStart() {
            const scrollContainer = document.querySelector('.calendar-scroll');
            if (scrollContainer && !hasAutoScrolled) {
                setTimeout(() => {
                    scrollContainer.scrollLeft = 0;
                    hasAutoScrolled = true;
                }, 100);
            }
        }

        function scrollToToday() {
            const today = new Date();
            const scrollContainer = document.querySelector('.calendar-scroll');

            if (today >= viewStartDate && today <= viewEndDate && scrollContainer) {
                const daysSinceStart = Math.ceil((today - viewStartDate) / (1000 * 60 * 60 * 24));
                const totalWidth = scrollContainer.scrollWidth;
                const viewWidth = scrollContainer.clientWidth;

                const todayPosition = (daysSinceStart / totalDays) * totalWidth;
                const scrollPosition = todayPosition - (viewWidth / 2);

                scrollContainer.scrollLeft = Math.max(0, Math.min(scrollPosition, totalWidth - viewWidth));
            }
        }

        function renderTimeline() {
            const timelineHeader = document.getElementById('timelineHeader');
            const dayGrid = document.getElementById('dayGrid');
            const calendarContent = document.querySelector('.calendar-content');

            timelineHeader.innerHTML = '';
            dayGrid.innerHTML = '';

            const minWidth = Math.max(1200, totalDays * 15);
            if (calendarContent) {
                calendarContent.style.width = `${minWidth}px`;
            }

            // Group days by month
            const months = {};
            const currentDate = new Date(viewStartDate);

            for (let i = 0; i < totalDays; i++) {
                const monthKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}`;
                const monthName = currentDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });

                if (!months[monthKey]) {
                    months[monthKey] = { name: monthName, days: 0 };
                }
                months[monthKey].days++;

                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                dayGrid.appendChild(dayColumn);

                currentDate.setDate(currentDate.getDate() + 1);
            }

            // Render month headers
            Object.values(months).forEach(month => {
                const monthHeader = document.createElement('div');
                monthHeader.className = 'month-header';
                monthHeader.textContent = month.name;
                monthHeader.style.flex = month.days;
                timelineHeader.appendChild(monthHeader);
            });
        }

        function renderCalendarExperiments() {
            const timelineBody = document.getElementById('timelineBody');
            const experimentBars = document.getElementById('experimentBars');

            experimentBars.innerHTML = '';

            const filteredExperiments = getFilteredExperiments();

            if (filteredExperiments.length === 0) {
                timelineBody.style.height = '200px';
                return;
            }

            const lanes = assignLanes(filteredExperiments);
            const maxLanes = Object.keys(lanes).length > 0 ? Math.max(...Object.values(lanes)) + 1 : 1;
            timelineBody.style.height = `${Math.max(maxLanes * 48, 200)}px`;

            filteredExperiments.forEach((exp) => {
                const row = document.createElement('div');
                row.className = 'experiment-bar-row';
                row.style.top = `${(lanes[exp.id] || 0) * 48}px`;
                row.style.position = 'absolute';
                row.style.width = '100%';
                experimentBars.appendChild(row);

                const expStart = new Date(exp.startDate);
                const expEnd = new Date(exp.endDate);

                if (expEnd >= viewStartDate && expStart <= viewEndDate) {
                    const startDay = Math.max(0, Math.ceil((expStart - viewStartDate) / (1000 * 60 * 60 * 24)));
                    const endDay = Math.min(totalDays, Math.ceil((expEnd - viewStartDate) / (1000 * 60 * 60 * 24)) + 1);
                    const duration = endDay - startDay;

                    const bar = document.createElement('div');
                    const overallStatus = getOverallStatus(exp);
                    bar.className = `experiment-bar ${overallStatus}`;

                    // Create icons container
                    const iconsContainer = document.createElement('div');
                    iconsContainer.className = 'experiment-bar-icons';

                    // Get unique platforms from the experiment
                    const uniquePlatforms = [...new Set(exp.platforms.map(p => p.platform))];

                    // Add platform icons
                    uniquePlatforms.forEach(platform => {
                        const icon = document.createElement('img');
                        icon.className = 'experiment-bar-icon';

                        // Map platform names to icon files
                        const iconMap = {
                            'Web': 'web.png',
                            'iOS': 'apple.png',
                            'Android': 'android.png'
                        };

                        icon.src = iconMap[platform] || 'web.png';
                        icon.alt = platform;
                        icon.onerror = function() {
                            // Hide icon if image fails to load
                            this.style.display = 'none';
                        };

                        iconsContainer.appendChild(icon);
                    });

                    // Create text container with flexbox layout
                    const textContainer = document.createElement('div');
                    textContainer.className = 'experiment-bar-text';

                    // Create experiment name element (left-aligned)
                    const nameElement = document.createElement('div');
                    nameElement.className = 'experiment-bar-name';
                    nameElement.textContent = exp.name;

                    // Create date range element (right-aligned)
                    const dateElement = document.createElement('div');
                    dateElement.className = 'experiment-bar-date';
                    const startDateFormatted = formatDateShort(exp.startDate);
                    const endDateFormatted = formatDateShort(exp.endDate);
                    dateElement.textContent = `${startDateFormatted}-${endDateFormatted}`;

                    // Append name and date to text container
                    textContainer.appendChild(nameElement);
                    textContainer.appendChild(dateElement);

                    // Append icons and text to bar
                    bar.appendChild(iconsContainer);
                    bar.appendChild(textContainer);

                    bar.style.left = `${(startDay / totalDays) * 100}%`;
                    bar.style.width = `${(duration / totalDays) * 100}%`;

                    bar.addEventListener('mouseenter', (e) => showTooltip(e, exp));
                    bar.addEventListener('mouseleave', hideTooltip);

                    row.appendChild(bar);
                }
            });
        }

        function getOverallStatus(exp) {
            // Get the most prominent status from all platforms
            // Priority order: started > ready-to-stop > in-review > ready-to-start > ended
            const statusPriority = {
                'started': 5,
                'ready-to-stop': 4,
                'in-review': 3,
                'ready-to-start': 2,
                'ended': 1
            };

            let mostProminentStatus = null;
            let highestPriority = 0;

            exp.platforms.forEach(platform => {
                const status = platform.status.toLowerCase().replace(/\s+/g, '-');
                const priority = statusPriority[status] || 0;

                if (priority > highestPriority) {
                    highestPriority = priority;
                    mostProminentStatus = status;
                }
            });

            // Return status class name
            return mostProminentStatus ? `status-${mostProminentStatus}` : 'status-ended';
        }

        function assignLanes(experimentsToAssign) {
            const lanes = {};
            const sortedExps = [...experimentsToAssign].sort((a, b) =>
                new Date(a.startDate) - new Date(b.startDate)
            );

            sortedExps.forEach(exp => {
                const expStart = new Date(exp.startDate);
                const expEnd = new Date(exp.endDate);
                let lane = 0;

                while (true) {
                    let canUseLane = true;

                    for (const [otherId, otherLane] of Object.entries(lanes)) {
                        if (otherLane === lane) {
                            const other = sortedExps.find(e => e.id === otherId);
                            if (other) {
                                const otherStart = new Date(other.startDate);
                                const otherEnd = new Date(other.endDate);

                                if (!(expEnd < otherStart || expStart > otherEnd)) {
                                    canUseLane = false;
                                    break;
                                }
                            }
                        }
                    }

                    if (canUseLane) {
                        lanes[exp.id] = lane;
                        break;
                    }
                    lane++;
                }
            });

            return lanes;
        }

        function formatDateShort(dateString) {
            const date = new Date(dateString);
            const month = date.toLocaleDateString('en-US', { month: 'short' });
            const day = date.getDate();
            return `${month} ${day}`;
        }

        function showTooltip(event, experiment) {
            const rect = event.target.getBoundingClientRect();
            const platforms = experiment.platforms.map(p =>
                `${p.platform}: ${p.status.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}`
            ).join('<br>');

            tooltip.innerHTML = `
                <strong>${experiment.name}</strong><br>
                ${platforms}<br>
                Start: ${new Date(experiment.startDate).toLocaleDateString()}<br>
                End: ${new Date(experiment.endDate).toLocaleDateString()}
            `;
            tooltip.style.left = `${rect.left + rect.width / 2}px`;
            tooltip.style.top = `${rect.top - 10}px`;
            tooltip.style.transform = 'translate(-50%, -100%)';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            tooltip.classList.remove('show');
        }

        function updateCalendarStats() {
            const filteredExperiments = getFilteredExperiments();

            let running = 0, ended = 0, pending = 0;

            filteredExperiments.forEach(exp => {
                const status = getOverallStatus(exp);
                // Map new status classes to old categories for stats
                if (status === 'status-started') running++;
                else if (status === 'status-ended') ended++;
                else if (status === 'status-in-review' || status === 'status-ready-to-start' || status === 'status-ready-to-stop') pending++;
            });

            document.getElementById('totalExperiments').textContent = filteredExperiments.length;
            document.getElementById('runningCount').textContent = running;
            document.getElementById('endedCount').textContent = ended;
            document.getElementById('pendingCount').textContent = pending;
        }

        function positionTodayMarker() {
            const today = new Date();
            const todayMarker = document.getElementById('todayMarker');

            if (today >= viewStartDate && today <= viewEndDate) {
                const daysSinceStart = Math.ceil((today - viewStartDate) / (1000 * 60 * 60 * 24));
                const position = (daysSinceStart / totalDays) * 100;
                todayMarker.style.left = `${position}%`;
                todayMarker.style.display = 'block';
            } else {
                todayMarker.style.display = 'none';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>