<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B Testing Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            /* Light theme colors */
            --bg-primary: #f8f8f8;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-accent: #4b5563;
            --bg-input: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #e9ecef;
            --bg-section-header: #f8f9fa;
            --bg-section-header-hover: #e9ecef;

            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #495057;
            --text-light: #ffffff;
            --text-accent: #1976d2;

            --border-color: #e2e8f0;
            --border-light: #dee2e6;
            --border-medium: #9ca3af;

            --shadow-light: 0 2px 12px rgba(0,0,0,0.06);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-card: 0 1px 4px rgba(0,0,0,0.05);

            --accent-blue: #1976d2;
            --accent-blue-hover: #1565c0;
            --accent-red: #dc2626;
            --accent-green: #28a745;
            --accent-orange: #f59e0b;

            --chart-bg: #f8f9fa;
            --note-bg: #f8f9fa;
            --metric-bg: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }



        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            padding-top: 220px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 20px 20px;
        }
        .header {
            position: fixed;
            top: 0px;
            left: 0;
            right: 0;
            z-index: 1000;
            background: var(--bg-primary);
            margin: 0;
            display: flex;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .header-container {
            max-width: 1400px;
            width: 100%;
            margin: 0;
            padding: 0 20px;
        }



        .main-header {
            padding: 20px 24px;
            background: rgb(67, 87, 107);
            border: 1px solid var(--border-medium);
            border-top: none;
            transition: background-color 0.3s ease;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;

        }

        .header-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .id-badge {
            background: var(--accent-blue);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 16px;
            font-weight: 700;
        }

        .title-area {
            flex: 1;
            min-width: 0;
        }

        .experiment-title {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            line-height: 1.4;
            margin: 0;
        }

        .meta-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .meta-left {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .platform-chips {
            display: flex;
            gap: 6px;
        }

        .platform-chip {
            background: #6b7280;
            color: #f3f4f6;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .platform-chip:hover {
            background: #9ca3af;
            color: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }

        .platform-chip.active {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
            color: white;
            font-weight: 700;
            box-shadow: 0 1px 2px rgba(75, 85, 99, 0.2);
        }

        .subscriber-pill {
            display: flex;
            align-items: center;
            background: #6b7280;
            border: 1px solid #9ca3af;
            border-radius: 20px;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .heart-section {
            padding: 6px 8px 6px 12px;
            display: flex;
            align-items: center;
            position: relative;
            border-right: 1px solid #9ca3af;
            transition: all 0.2s;
        }

        .heart-section:hover {
            background: rgba(156, 163, 175, 0.2);
        }

        .subscribers-section {
            padding: 6px 12px 6px 8px;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .subscribers-section:hover {
            background: rgba(156, 163, 175, 0.2);
        }

        .subscriber-pill:hover {
            background: #6b7280;
            border-color: #d1d5db;
        }

        /* Experiment Status Card Styles */
.experiment-status-card {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 32px 24px;
    margin-bottom: 24px;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-light);
    max-width: 280px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    transition: all 0.3s ease;
}

.warning-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #dc2626;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    transition: all 0.2s ease;
    /* No shadows, no gradients as requested */
}

.warning-btn:hover {
    background: #b91c1c;
    transform: scale(1.1);
}

.warning-btn:active {
    transform: scale(0.95);
}

.warning-platform-name {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
}

.status-card-action {
    margin-top: 8px;
}

.status-card-btn {
    width: 100%;
    padding: 16px 24px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-card-start {
    background: #22c55e;
    color: white;
}

.status-card-start:hover {
    background: #16a34a;
    transform: translateY(-1px);
}

.status-card-start:active {
    transform: translateY(0);
}

        /* Responsive adjustments for the status card */
        @media (max-width: 768px) {
            .experiment-status-card {
                max-width: 100%;
                margin-bottom: 20px;
                padding: 24px 20px;
            }

            .main-platform-icon {
                width: 64px;
                height: 64px;
            }

            .main-platform-icon svg {
                width: 36px;
                height: 36px;
            }

            .warning-btn {
                width: 28px;
                height: 28px;
            }

            .warning-btn svg {
                width: 14px;
                height: 14px;
            }

            .warning-platform-name {
                font-size: 16px;
            }

            .status-card-btn {
                padding: 14px 20px;
                font-size: 14px;
            }
        }

        /* Subscribers Modal */
        .subscribers-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        /* Variant Override Modal */
.variant-override-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.variant-override-modal.show {
    opacity: 1;
    visibility: visible;
}

.variant-override-modal-content {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 24px;
    max-width: 520px;
    width: 90%;
    box-shadow: var(--shadow-medium);
    border: 1px solid var(--border-color);
    transform: translateY(-20px);
    transition: transform 0.3s ease;
}

.variant-override-modal.show .variant-override-modal-content {
    transform: translateY(0);
}

/* Variant Override Modal Styles */
.variant-override-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border-light);
}

.variant-override-modal-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
}

.variant-override-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: all 0.2s;
}

.variant-override-modal-close:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

/* NEW: Recommended Variant Info */
.recommended-variant-info {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
    border: 1px solid var(--accent-orange);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
}

.recommended-variant-info h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--accent-orange);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.recommended-icon {
    width: 16px;
    height: 16px;
}

.recommended-variant-info p {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.4;
}

.current-winner-info {
    background: var(--bg-secondary);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
    border-left: 4px solid var(--accent-blue);
}

.current-winner-info h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.current-winner-info p {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.4;
}

.variant-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
}

.variant-option {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
}

.variant-option:hover {
    border-color: var(--accent-blue);
    background: var(--bg-hover);
}

.variant-option.selected {
    border-color: var(--accent-blue);
    background: rgba(25, 118, 210, 0.05);
}

/* NEW: Recommended variant styling */
.variant-option.recommended {
    border-color: var(--accent-orange);
    background: rgba(251, 191, 36, 0.05);
}

.variant-option.recommended:hover {
    border-color: var(--accent-orange);
    background: rgba(251, 191, 36, 0.1);
}

.variant-option.recommended.selected {
    border-color: var(--accent-orange);
    background: rgba(251, 191, 36, 0.1);
}

.recommended-badge {
    position: absolute;
    top: -8px;
    right: 12px;
    background: var(--accent-orange);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.variant-radio {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 2px solid var(--border-medium);
    position: relative;
    flex-shrink: 0;
    transition: all 0.2s ease;
}

.variant-option.selected .variant-radio {
    border-color: var(--accent-blue);
}

.variant-option.recommended .variant-radio {
    border-color: var(--accent-orange);
}

.variant-option.selected .variant-radio::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-blue);
}

.variant-option.recommended.selected .variant-radio::after {
    background: var(--accent-orange);
}

.variant-details {
    flex: 1;
}

.variant-label {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.variant-description {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.4;
}

.variant-badge {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent-blue);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 700;
    flex-shrink: 0;
}

.modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.modal-btn {
    padding: 10px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.modal-btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-muted);
    border: 1px solid var(--border-color);
}

.modal-btn-secondary:hover {
    background: var(--bg-hover);
}

.modal-btn-primary {
    background: var(--accent-blue);
    color: white;
    border: 1px solid var(--accent-blue);
}

.modal-btn-primary:hover {
    background: var(--accent-blue-hover);
    border-color: var(--accent-blue-hover);
    transform: translateY(-1px);
}

.modal-btn-primary:disabled {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border-color: var(--border-light);
    cursor: not-allowed;
    transform: none;
}

        .subscribers-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .subscribers-modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 500px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .subscribers-modal.show .subscribers-modal-content {
            transform: translateY(0);
        }

        .subscribers-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .subscribers-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .subscribers-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .subscribers-modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .subscribers-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .subscriber-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .subscriber-item:last-child {
            border-bottom: none;
        }

        .subscriber-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .subscriber-details {
            flex: 1;
        }

        .subscriber-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .subscriber-role {
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 2px;
        }

        .subscriber-date {
            color: var(--text-secondary);
            font-size: 12px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .subscriber-pill .subscription-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1001;
        }

        .subscriber-pill .subscription-tooltip::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 4px solid rgba(0, 0, 0, 0.9);
        }

        .subscriber-pill:hover .subscription-tooltip {
            opacity: 1;
        }

        .heart-icon {
            color: #f3f4f6;
            font-size: 14px;
            transition: all 0.2s;
        }

        .subscriber-pill:hover .heart-icon {
            color: #ef4444;
            transform: scale(1.1);
        }

        .subscriber-pill.subscribed .heart-icon {
            color: #ef4444;
        }

        .subscriber-info {
            font-size: 13px;
            color: #ffffff;
            font-weight: 600;
        }

        .approval-compact {
            color: #f3f4f6;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
        }

        .meta-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .tool-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: white;
            border-radius: 50%; /* Change from 6px to 50% for perfect circles */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #6c757d;
            font-size: 13px;
            transition: all 0.2s;
            box-shadow: none;
        }



        .tool-btn:hover {
            background: #9ca3af;
            border-color: #d1d5db;
            color: #ffffff;
            transform: translateY(-1px);
        }

        .heart-outline {
            display: inline;
        }

        .heart-filled {
            display: none;
        }

        .subscriber-pill.subscribed .heart-outline {
            display: none;
        }

        .subscriber-pill.subscribed .heart-filled {
            display: inline !important;
            animation: heartPulse 0.3s ease-out;
        }

        @keyframes heartPulse {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            position: relative;
            padding: 8px 8px 8px 12px;
            /* Reserve space on the right so tabs never shift when actions appear */
            padding-right: var(--tab-actions-reserve, 320px);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            border-radius: 0 0 8px 8px;
            transition: background-color 0.3s ease;
            display: block; /* let children flow; actions will be absolutely positioned */
        }

        .tab-actions {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            visibility: hidden; /* toggled to visible on configuration tab */
            align-items: center;
            gap: 8px;
        }

        .tab-list {
            display: flex;
            gap: 0;
            max-width: 1400px;
            margin: 0 auto;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tab-list::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            position: relative;
            padding: 16px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            border: none;
            border-radius: 8px;
            transition: all 0.15s ease-out;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 4px;
        }

        .tab-item:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
            border: none;
            border-radius: 8px;
            margin: 8px 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03), 0 1px 2px rgba(0, 0, 0, 0.02);
            position: relative;
            z-index: 1;
        }

        .tab-item.active {
            color: white;
            background: #059669;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            margin: 8px 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.03);
            position: relative;
            z-index: 1;
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Environment Tabs Styles - More Subtle */
        .environment-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .environment-tab {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
            white-space: nowrap;
        }

        .environment-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .environment-tab.active {
            color: var(--text-primary);
            background: var(--bg-card);
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        .environment-content {
            margin-top: 0;
        }

        .environment-tab-content {
            display: none;
        }

        .environment-tab-content.active {
            display: block;
        }

        .workflow-section {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 24px;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .workflow-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .workflow-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .workflow-stage {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .workflow-eta {
            color: var(--text-secondary);
        }

        .workflow-metrics {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
            padding: 20px 24px;
            background: var(--metric-bg);
            border-radius: 12px;
        }

        .metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 8px;
            box-shadow: var(--shadow-card);
            transition: all 0.2s ease;
        }

        .metric:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-blue);
            line-height: 1;
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .workflow-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            padding: 0 24px;
        }

        .workflow-steps::before {
            content: '';
            position: absolute;
            top: 24px;
            left: 48px;
            right: 48px;
            height: 2px;
            background: var(--border-light);
            z-index: 1;
        }

        .workflow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-indicator {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 3px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .workflow-step.completed .step-indicator {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }

        .workflow-step.active .step-indicator {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #42a5f5 100%);
            border-color: var(--accent-blue);
            color: white;
            box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
            animation: activeStepPulse 3s ease-in-out infinite;
        }

        @keyframes activeStepPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
            }
            25% {
                transform: scale(1.05);
                box-shadow: 0 0 0 8px rgba(25, 118, 210, 0.15);
            }
            50% {
                transform: scale(1.08);
                box-shadow: 0 0 0 12px rgba(25, 118, 210, 0.1);
            }
            75% {
                transform: scale(1.05);
                box-shadow: 0 0 0 8px rgba(25, 118, 210, 0.15);
            }
        }

        .step-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 4px;
        }

        .workflow-step.completed .step-label,
        .workflow-step.active .step-label {
            color: var(--text-primary);
            font-weight: 600;
        }

        .step-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* New Workflow Status Grid Styles */
        .workflow-status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 24px;
            align-items: stretch; /* Makes both sections same height */
        }

        .status-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            border: none;
            transition: all 0.3s ease;
        }

        .status-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-align: center;
            padding-bottom: 8px;
        }

        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .platform-status-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            height: 160px;
            justify-content: space-between;
            position: relative;
        }

        .platform-icon {
            color: var(--text-secondary);
            transition: none;
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .platform-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .status-btn {
            padding: 8px 20px;
            border-radius: 20px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-btn-approve {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .status-btn-approve:hover {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .status-btn-stop {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .status-btn-stop:hover {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .status-btn-start {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .status-btn-start:hover {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* NEW: Ended Status Container */
        .ended-status-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .ended-status-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .select-winner-btn {
            background: linear-gradient(135deg, var(--accent-orange) 0%, #d97706 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .select-winner-btn:hover {
            background: linear-gradient(135deg, #fbbf24 0%, var(--accent-orange) 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Winner Selected State */
        .winner-selected-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .winner-selected-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

  .winner-badge {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-blue);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;  /* <-- Add this if not present */
}

.winner-display {
    display: flex;
    align-items: center;  /* <-- This should align them vertically */
    gap: 8px;
    background: var(--bg-secondary);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s ease;
}

        .winner-display:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .winner-badge {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }

.winner-text {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 20px;  /* <-- Add this to match badge height */
}

        .platform-warning-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 10;
        }

        .mini-warning-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #dc2626;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: all 0.2s ease;
            /* No shadows, no gradients as requested */
        }

        .mini-warning-btn:hover {
            background: #b91c1c;
            transform: scale(1.15);
        }

        .mini-warning-btn:active {
            transform: scale(0.95);
        }

        .platform-status-card.has-warning {
            border-color: #dc2626;
            background: var(--bg-card);
        }

        .platform-status-card.has-warning:hover {
            border-color: #b91c1c;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.15);
        }

        /* Winner Card Styles */
.platform-status-card.winner-card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: visible;
    justify-content: space-between;
    gap: 8px;
    transition: all 0.3s ease;
}

        .platform-status-card.winner-card:hover {
            transform: none;
            box-shadow: none;
            border-color: var(--border-color);
        }

        .experiment-status {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

.winner-badge {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-blue);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;  /* <-- Add this if not present */
}

        .winner-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .winner-card .experiment-status {
            margin-top: 0;
            font-size: 13px;
        }

        .medal-icon {
            width: 36px;
            height: 36px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            animation: medalShine 2s ease-in-out infinite;
        }

        /* Responsive adjustments for mini warning buttons */
        @media (max-width: 768px) {
            .platform-warning-indicator {
                top: 6px;
                right: 6px;
            }

            .mini-warning-btn {
                width: 18px;
                height: 18px;
            }

            .mini-warning-btn svg {
                width: 10px;
                height: 10px;
            }
        }

        /* Mobile Responsive Styles for New Workflow */
        @media (max-width: 768px) {
            .workflow-section {
                padding: 16px;
            }

            .workflow-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                margin-bottom: 12px;
            }

            .environment-tabs {
                align-self: stretch;
            }

            .environment-tab {
                padding: 8px 12px;
                font-size: 11px;
                min-width: 60px;
            }

            .status-section {
                padding: 12px;
            }

            .status-section-title {
                margin-bottom: 8px;
                padding-bottom: 6px;
            }

            .workflow-status-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .platforms-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .platform-status-card {
                padding: 12px 10px;
                height: 140px;
                gap: 6px;
            }

            .platform-icon-container {
                width: 40px;
                height: 40px;
            }

            .platform-icon {
                width: 24px;
                height: 24px;
            }

            .status-btn {
                padding: 8px 12px;
                font-size: 11px;
                min-width: 60px;
            }
        }

        /* Pre-Launch Checklist Styles */
        .checklist-task-item {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid var(--border-light);
        }

        /* Section header with action button */
        .status-section-header-with-action {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 12px;
        }

        .status-section-header-with-action .status-section-title {
            margin-bottom: 0;
            padding-bottom: 0;
            text-align: center;
            flex: 1;
            margin-left: 100px;
        }

        .status-section-header-with-action .status-btn {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 80px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .status-section-header-with-action {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        /* Disabled start button */
        .status-btn-start-disabled {
            background: #9ca3af;
            color: #6b7280;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }

        .status-btn-start-disabled:hover {
            background: #9ca3af;
            transform: none;
            box-shadow: none;
        }

        /* Disabled button styles */
        .btn:disabled,
        .btn.disabled {
            background: var(--bg-tertiary) !important;
            color: var(--text-secondary) !important;
            border-color: var(--border-light) !important;
            cursor: not-allowed !important;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
            pointer-events: none;
        }

        .btn:disabled:hover,
        .btn.disabled:hover {
            background: var(--bg-tertiary) !important;
            color: var(--text-secondary) !important;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Mobile responsive for section header */
        @media (max-width: 768px) {
            .status-section-header-with-action {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
                margin-bottom: 8px;
            }

            .status-section-header-with-action .status-btn {
                padding: 8px 16px;
                font-size: 12px;
                margin-left: 0;
            }
        }

        .checklist-task-item:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1);
        }

        .checklist-task-item.completed {
            background: var(--bg-card);
            border-color: var(--border-light);
            border-left: 3px solid var(--accent-green);
        }

        .checklist-task-item.required {
            background: var(--bg-card);
            border-color: var(--border-light);
            border-left: 3px solid var(--accent-red);
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-medium);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .task-checkbox.checked {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            flex-grow: 1;
            font-size: 16px;
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .status-pending {
            background: #fef3c7;
            color: #78350f;
        }



        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }



        .status-optional {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* In Review status style */
        .status-in-review-label {
            font-size: 13px;
            font-weight: 600;
            color: #f59e0b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 0;
            text-align: center;
        }

        .task-description {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .task-details {
            background: var(--bg-secondary);
            border-radius: 6px;
            padding: 16px;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.5;
            transition: background-color 0.3s ease;
        }

        .signed-off-by {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
            font-size: 13px;
            color: var(--accent-green);
            font-weight: 500;
        }

        .main-content {
            padding: 20px 0;
        }

        .section {
            background: var(--bg-card);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .section:hover {
            box-shadow: var(--shadow-medium);
        }

        .section-header {
            padding: 20px 24px;
            background: var(--bg-section-header);
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .section-header.no-toggle {
            cursor: default;
        }

        .section-header:hover:not(.no-toggle) {
            background: var(--bg-section-header-hover);
        }

        .section-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .section-icon {
            width: 20px;
            height: 20px;
        }

        .toggle-icon {
            transition: transform 0.2s ease;
            color: var(--text-secondary);
        }

        .section.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 0 24px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.25s ease, opacity 0.2s ease, padding 0.25s ease;
        }

        .section.expanded .section-content {
            padding: 24px;
            max-height: 2000px;
            opacity: 1;
        }

/* Enhanced Platform Status Cards */
.platform-status-card.enhanced-card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
}

/* Standardize ALL platform icon containers to same size */
.platform-icon-container {
    width: 48px;
    height: 48px;
    min-width: 48px;
    min-height: 48px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 4px;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.platform-icon-container.enhanced {
    width: 64px;
    height: 64px;
    background: var(--bg-accent);
    color: white;
    margin-bottom: 8px;
}

.platform-icon-container.enhanced svg {
    width: 48px;
    height: 48px;
}

.platform-name-with-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    margin-bottom: 8px;
    flex-wrap: wrap;
    line-height: 1; /* Add this */
}

.platform-name-with-warning .platform-name {
    line-height: 1; /* Add this rule */
    margin: 0; /* Add this */
    display: flex; /* Add this */
    align-items: center; /* Add this */
}

.warning-btn-inline {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #dc2626;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    transition: all 0.2s ease;
    flex-shrink: 0;
    order: -1; /* Places warning icon before the text */
    font-size: 14px;
    font-weight: bold;
    line-height: 1;
}

.warning-btn-inline:hover {
    background: #b91c1c;
    transform: scale(1.05);
}

.warning-btn-inline:active {
    transform: scale(0.95);
}

/* Enhanced cards get slightly different styling for action buttons */
.enhanced-card .status-btn {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

.enhanced-card .status-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
    .workflow-status-grid {
        grid-template-columns: 1fr;
        gap: 20px;
        align-items: stretch; /* On mobile, don't center vertically */
    }

    .platform-icon-container {
        width: 48px;
        height: 48px;
    }

    .platform-icon {
        width: 36px;
        height: 36px;
    }

    .warning-btn-inline {
        width: 18px;
        height: 18px;
        font-size: 12px;
    }

    .platform-name-with-warning {
        gap: 6px;
    }
}

        /* For single sections in tabs, show content only when expanded or when no-toggle */
        .tab-content .section.expanded .section-content,
        .tab-content .section .section-header.no-toggle + .section-content {
            padding: 24px;
            max-height: 2000px;
            opacity: 1;
        }

        .tab-content .section .section-content {
            padding: 0 24px;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .tab-content .section .section-header.no-toggle + .section-content {
            transition: none;
        }

        .platform-specific {
            position: relative;
        }

        .variants-container {
            display: flex;
            gap: 32px;
            align-items: flex-start;
        }

        .pie-chart-container {
            position: relative;
            background: var(--chart-bg);
            border-radius: 8px;
            padding: 40px;
            transition: background-color 0.3s ease;
            width: 300px;
            flex-shrink: 0;
        }

        .variants-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: flex-start;
            flex: 1;
        }

        .variant-item {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .variant-item:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1);
        }

        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .variant-label {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .variant-percentage {
            background: var(--accent-blue);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .variant-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .variant-a {
            border-left: 4px solid #ff6b6b;
        }

        .variant-b {
            border-left: 4px solid #4ecdc4;
        }

        .variant-c {
            border-left: 4px solid #9b59b6;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .config-item.full-width {
            grid-column: 1 / -1;
        }

        .config-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .config-value {
            font-size: 16px;
            color: var(--text-primary);
            padding: 8px 0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--bg-input);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        /* Card layout (match ABEX) */
        .card-layout { display: grid; gap: 24px; }
        .card { background: #F9F9FB; border: 1px solid #E5E5E7; border-radius: 12px; padding: 24px; }
        .card-header { margin-bottom: 22px; }
        .card-title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
        .card-subtitle { font-size: 13px; color: var(--text-secondary); margin-top: 4px; margin-bottom: 16px; }
        /* Inline options layout (radio/checkbox) */
        .inline-options { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        /* Grid layout utility for inline form rows */
        .form-grid { display: grid; gap: 20px; }

        /* Option descriptions for experiment type (wizard parity) */
        .checkbox-content { display: flex; flex-direction: column; gap: 4px; }
        .option-description { font-size: 13px; color: var(--text-secondary); line-height: 1.4; }



        .checkbox-input {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-blue);
        }

        .checkbox-label {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .file-upload {
            border: 2px dashed var(--border-light);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--bg-secondary);
        }

        .file-upload:hover {
            border-color: var(--accent-blue);
            background: rgba(25, 118, 210, 0.05);
        }

        .file-upload-icon {
            width: 48px;
            height: 48px;
            color: var(--text-secondary);
            margin: 0 auto 16px;
        }

        .note-item {
            background: var(--note-bg);
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
            transition: background-color 0.3s ease;
        }

        .note-author {
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 4px;
        }

        .note-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .audit-item {
            padding: 16px 0;
        }

        .audit-item:last-child {
            border-bottom: none;
        }

        .audit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .audit-user {
            font-weight: 600;
            color: var(--text-primary);
        }

        .audit-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .audit-changes {
            font-size: 14px;
            color: var(--text-muted);
            font-family: 'Monaco', 'Menlo', monospace;
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .banners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .banner-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }

        .banner-checkbox {
            width: 16px;
            height: 16px;
            accent-color: var(--accent-blue);
        }

        .individual-banners {
            transition: all 0.3s ease;
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .individual-banners.hidden {
            display: none;
        }

        .date-input {
            position: relative;
        }

        .date-input input[type="date"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--bg-input);
            color: var(--text-primary);
            color-scheme: light;
        }

        .date-input input[type="date"]:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .spaces-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        .spaces-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .space-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            box-shadow: var(--shadow-card);
            transition: all 0.2s ease;
        }

        .space-item.home-space {
            background: #ff6b6b;
            border: none;
        }

        .space-item.home-space .space-icon {
            color: white;
        }

        .space-item.home-space .space-name {
            color: white;
        }

        .space-item.search-space {
            background: #06b6d4;
            border: none;
        }

        .space-item.search-space .space-icon {
            color: white;
        }

        .space-item.search-space .space-name {
            color: white;
        }

        .space-icon {
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .space-name {
            color: var(--text-primary);
        }

        .space-count {
            background: var(--text-secondary);
            color: white;
            padding: 0;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .space-count:hover {
            background: var(--accent-red);
            transform: scale(1.1);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
            border: 1px solid var(--accent-blue);
        }

        .btn-primary:hover {
            background: var(--accent-blue-hover);
            border-color: var(--accent-blue-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .status-running-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 0;
            text-align: center;
        }

/* Platform Name with Inline Warning Icon */
.platform-name-with-warning {
    display: flex;
    align-items: center;
    gap: 6px;
    justify-content: center;
    margin-bottom: 8px;
}

.inline-warning-btn {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #dc2626;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    transition: all 0.2s ease;
    flex-shrink: 0;
    /* No shadows, no gradients as requested */
}

.inline-warning-btn:hover {
    background: #b91c1c;
    transform: scale(1.15);
}

.inline-warning-btn:active {
    transform: scale(0.95);
}

.platform-status-card.has-warning:hover {
    /* Same hover effect as regular cards */
    transform: translateY(-2px);
    box-shadow: var(--shadow-card);
    border-color: var(--accent-blue);
}

/* Responsive adjustments for inline warning buttons */
@media (max-width: 768px) {
    .platform-name-with-warning {
        gap: 4px;
    }

    .inline-warning-btn {
        width: 16px;
        height: 16px;
    }

    .inline-warning-btn svg {
        width: 10px;
        height: 10px;
    }
}

        /* Experiment Isolation Styles */
        .isolation-container {
            background: transparent;
            border-radius: 8px;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        .assignment-card {
            background: #F9F9FB;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #E5E5E7;
            transition: all 0.3s ease;
        }

        .assignment-card:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
        }

        .assignment-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 24px;
            align-items: start;
        }

        .assignment-divider {
            width: 1px;
            height: 100%;
            min-height: 120px;
            background: var(--border-light);
            justify-self: center;
        }

        .assignment-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .assignment-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
        }

        .assignment-label {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .assignment-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .assignment-value.pool-id,
        .assignment-value.lane-id {
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 12px;
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid var(--border-light);
        }

        .assignment-value.traffic-allocation {
            background: var(--accent-green);
            color: white;
            padding: 4px 12px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            body {
                padding-top: 260px;
            }

            .header-row {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .meta-footer {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .meta-left, .meta-right {
                justify-content: center;
            }

            .variants-container {
                flex-direction: column;
                gap: 20px;
            }

            .workflow-steps {
                flex-direction: column;
                gap: 12px;
            }

            .workflow-steps::before {
                display: none;
            }

            .workflow-metrics {
                flex-direction: column;
                gap: 4px;
            }

            .metric {
                padding: 6px 4px;
            }

            .metric-value {
                font-size: 12px;
            }

            .spaces-list {
                justify-content: center;
            }

            .tab-list {
                padding: 0 12px;
            }

            .tab-item {
                padding: 12px 16px;
                font-size: 13px;
            }

            /* Mobile styles for Experiment Isolation */
            .assignment-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .assignment-divider {
                width: 100%;
                height: 1px;
                min-height: 1px;
            }

            .assignment-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .assignment-label {
                font-size: 15px;
            }

            .assignment-value {
                font-size: 13px;
            }

            .assignment-value.traffic-allocation {
                font-size: 13px;
                padding: 3px 10px;
                border-radius: 12px;
            }

        }
    </style>
</head>
<body>
    <!-- Sticky Header -->
    <div class="header">
        <div class="header-container">
            <!-- Tool Buttons (moved outside header background) -->
        <div style="background: var(--bg-primary); padding: 8px 24px; display: flex; justify-content: flex-end; gap: 12px;">

            <button class="tool-btn" title="Copy">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                </svg>
            </button>

            <button class="tool-btn" title="Delete">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
            </button>
        </div>

            <!-- Main Header -->
            <div class="main-header">
                <div class="header-row">
                    <div class="id-badge">2ad3de</div>

                <div class="title-area">
                    <h1 class="experiment-title">P8W1 Home App & Web New For You PZN Science Place Recommendations Test</h1>

                </div>

                    <div class="subscriber-pill">
                        <div class="heart-section" id="heart-toggle">
                            <span class="heart-icon heart-outline">♡</span>
                            <span class="heart-icon heart-filled">♥</span>
                            <div class="subscription-tooltip">Subscribe to get notifications</div>
                        </div>
                        <div class="subscribers-section" id="subscribers-button">
                            <span class="subscriber-info"><span id="subscriber-count">12</span> Subscribers</span>
                        </div>
                    </div>
                </div>

                <div class="meta-footer">
                <div class="meta-left">
                </div>

                <div class="meta-right">
                </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <div class="tab-list">
                    <div class="tab-item active" data-tab="workflow">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.5 1.5A.5.5 0 0 1 2 1h4.5a.5.5 0 0 1 0 1H2v4.5a.5.5 0 0 1-1 0V1.5zm13 0a.5.5 0 0 0-.5-.5H9.5a.5.5 0 0 0 0 1H14v4.5a.5.5 0 0 0 1 0V1.5zM2 14.5a.5.5 0 0 1-.5-.5V9.5a.5.5 0 0 1 1 0V14h4.5a.5.5 0 0 1 0 1H1.5zm13 0a.5.5 0 0 0 .5-.5V9.5a.5.5 0 0 0-1 0V14H9.5a.5.5 0 0 0 0 1h4.5z"/>
                            <path d="M5 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        Workflow
                    </div>
                    <div class="tab-item" data-tab="configuration">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/>
                        </svg>
                        Configuration
                    </div>
                    <div class="tab-item" data-tab="results">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zM1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
                        </svg>
                        Results
                    </div>
                    <div class="tab-item" data-tab="notes">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H4z"/>
                            <path d="M4.5 4a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7zM4 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 6.5zm0 3a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 4 9.5z"/>
                        </svg>
                        Notes
                    </div>
                    <div class="tab-item" data-tab="resources">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                        </svg>

                        Resources
                    </div>
                    <div class="tab-item" data-tab="audit">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                        </svg>
                        Audit Log
                    </div>
                </div>
                <div class="tab-actions" id="global-config-actions">
                    <button id="config-cancel-btn" type="button" class="btn btn-secondary" onclick="cancelEdits()" style="display:none;">Cancel Edits</button>
                    <button id="config-update-btn" type="button" class="btn btn-primary" onclick="enterEditMode()">Edit</button>
                </div>

            </div>
        </div>
    </div>


    <div class="container">
        <!-- Tab Contents -->

        <!-- Workflow Tab Content -->
        <div class="tab-content active" id="workflow-tab">

        <!-- Workflow-section -->
        <div class="workflow-section">
            <div class="workflow-header">
                <h3 class="workflow-title">Experiment Workflow</h3>
                <!-- Environment Tabs moved to header -->
                <div class="environment-tabs">
                    <div class="environment-tab active" data-environment="production">
                        Production
                    </div>
                    <div class="environment-tab" data-environment="stage">
                        Stage
                    </div>
                </div>
            </div>

            <!-- Tab Content Areas -->
            <div class="environment-content">
                <!-- Production Environment Content -->
                <div class="environment-tab-content active" id="production-content">
                    <div class="status-section">
                        <div class="status-section-header-with-action">
                            <h4 class="status-section-title">Production Environment</h4>
                            <button class="status-btn status-btn-approve" id="approve-btn">Approve</button>
                        </div>
                        <div class="platforms-grid">
                            <div class="platform-status-card" id="web-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                                    </svg>
                                </div>
                                <div class="platform-name">Web</div>
                                <span class="status-in-review-label" id="web-status">In Review</span>
                            </div>

                            <div class="platform-status-card enhanced-card" id="android-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M17.523 15.3414c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4482.9993.9993.0001.5511-.4482.9997-.9993.9997m-11.046 0c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4482.9993.9993 0 .5511-.4482.9997-.9993.9997m11.4045-6.02l1.9973-11.301c.0998-.2489-.0997-.4985-.3986-.4985H6.9232c-.0997 0-.1993.0997-.1993.1992 0 .0997.0898.1993.1993.1993h9.9802L15.3929 4.68H4.6395c-.3986 0-.6477.2489-.6477.6476v11.3016c0 .3987.2491.6476.6477.6476h13.2637c.3986 0 .6477-.2489.6477-.6476V5.2275c-.0001-.5514-.4481-1.0002-.9999-1.0002" />
                                    </svg>
                                </div>
                                <div class="platform-name-with-warning">
                                    <button class="warning-btn-inline" title="Android platform has conflicts">!</button>
                                    <span class="platform-name">Android</span>
                                </div>
                                <span class="status-in-review-label" id="android-status">In Review</span>
                            </div>

                            <div class="platform-status-card" id="ios-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                    </svg>
                                </div>
                                <div class="platform-name">iOS</div>
                                <span class="status-in-review-label" id="ios-status">In Review</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stage Environment Content -->
                <div class="environment-tab-content" id="stage-content">
                    <div class="status-section">
                        <h4 class="status-section-title">Stage Environment</h4>
                        <div class="platforms-grid">
                            <div class="platform-status-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                    </svg>
                                </div>
                                <div class="platform-name">iOS</div>
                                <span class="status-running-label">Running</span>
                            </div>

                            <div class="platform-status-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                                    </svg>
                                </div>
                                <div class="platform-name">Web</div>
                                <span class="status-running-label">Running</span>
                            </div>

                            <div class="platform-status-card">
                                <div class="platform-icon-container">
                                    <svg class="platform-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M17.523 15.3414c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4482.9993.9993.0001.5511-.4482.9997-.9993.9997m-11.046 0c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4482.9993.9993 0 .5511-.4482.9997-.9993.9997m11.4045-6.02l1.9973-11.301c.0998-.2489-.0997-.4985-.3986-.4985H6.9232c-.0997 0-.1993.0997-.1993.1992 0 .0997.0898.1993.1993.1993h9.9802L15.3929 4.68H4.6395c-.3986 0-.6477.2489-.6477.6476v11.3016c0 .3987.2491.6476.6477.6476h13.2637c.3986 0 .6477-.2489.6477-.6476V5.2275c-.0001-.5514-.4481-1.0002-.9999-1.0002" />
                                    </svg>
                                </div>
                                <div class="platform-name">Android</div>
                                <span class="status-running-label">Running</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


            <div class="section">
                <div class="section-header no-toggle">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        Pre-Launch Checklist
                    </h3>
                </div>
                <div class="section-content">
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">Complete all required tasks before starting your experiment</p>

                    <!-- Task 1: Analytics Setup (Required - Listed First) -->
                    <div class="checklist-task-item required" data-task="analytics">
                        <div class="task-header">
                            <div class="task-checkbox" onclick="toggleTask(this)"></div>
                            <div class="task-title">Analytics Tagging Verification</div>
                            <div class="task-status status-pending">Pending</div>
                        </div>
                        <div class="task-description">
                            Ensure all the metrics you want to measure are available with analytics (tagging) in place.
                        </div>
                        <div class="task-details">
                            <strong>Adobe Analytics:</strong> This step must be completed before a member of our team can approve your submission request.
                            <br><br>
                            Verify that all required event tracking, conversion goals, and custom dimensions are properly configured for this experiment.
                        </div>
                    </div>

                    <!-- Task 2: Development Implementation -->
                    <div class="checklist-task-item completed" data-task="development">
                        <div class="task-header">
                            <div class="task-checkbox checked">✓</div>
                            <div class="task-title">Development Implementation</div>
                            <div class="task-status status-completed">Completed</div>
                        </div>
                        <div class="task-description">
                            Develop/implement the experiment using the approved ExperimentID/TestID and the corresponding AMP asset.
                        </div>
                        <div class="task-details">
                            Experiment has been properly implemented with the approved configuration and tested in the development environment.
                            <div class="signed-off-by">
                                ✓ Signed off by Reiber, Mitch on 07/28/2025, 10:15 AM
                            </div>
                        </div>
                    </div>

                    <!-- Task 3: Desk Check -->
                    <div class="checklist-task-item completed" data-task="desk-check">
                        <div class="task-header">
                            <div class="task-checkbox checked">✓</div>
                            <div class="task-title">Desk Check Verification</div>
                            <div class="task-status status-completed">Completed</div>
                        </div>
                        <div class="task-description">
                            Confirm that the team has desk checked their work to ensure that the experiment is set to run properly.
                        </div>
                        <div class="task-details">
                            Team has verified all experiment parameters, targeting criteria, and implementation details are correct.
                            <div class="signed-off-by">
                                ✓ Confirmed by Dupler, Tiffany on 07/07/2025, 3:14 PM
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab Content -->
        <div class="tab-content" id="configuration-tab">
            <div class="main-content">
                <!-- Hypothesis Section -->
                <div class="section expanded" data-section="hypothesis">
                    <div class="section-header">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Hypothesis
                        </h3>
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </div>
                    <div class="section-content">
                            <div id="hypothesis-static" style="color: var(--text-primary); line-height: 1.6; font-size: 15px;">
                                By implementing a streamlined one-click add to cart experience from search results, we expect to see increased conversion rates and reduced cart abandonment as users can more quickly and easily add products to their cart without additional navigation steps.
                            </div>
                            <textarea id="hypothesis-textarea" class="form-input" rows="4" style="display:none; margin-top: 12px;"></textarea>
                    </div>
                </div>

                <!-- Variants Section -->
                <div class="section expanded" data-section="variants">
                    <div class="section-header" style="position:relative;">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 3v18h2v-8h6v8h2V3h-2v8H9V3H7z"/>
                                <path d="M3 12h4v2H3v-2z"/>
                                <path d="M17 12h4v2h-4v-2z"/>
                            </svg>
                            Variants
                        </h3>
                        <button id="variants-add-btn" class="btn btn-primary" type="button" onclick="addVariant(event)" style="display:none; position:absolute; right:80px; top:50%; transform:translateY(-50%); padding:6px 12px; font-size:13px;">+ Variant</button>
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </div>
                    <div class="section-content">
                        <p style="margin-bottom: 24px; color: var(--text-secondary);">Configure the control and variant experiences that are being tested.</p>

                            <div class="form-error" id="variants-error" style="display:none;">Allocations must be numbers and sum to 100%</div>

                        <div class="variants-container">
                            <div class="pie-chart-container">
                                <canvas id="variantsPieChart"></canvas>
                            </div>

                            <div class="variants-list">
                                <div class="variant-item variant-a">
                                    <div class="variant-header">
                                        <div class="variant-label">Variant A</div>
                                        <div class="variant-percentage" id="variant-A-allocation-static">20%</div>
                                    </div>
                                    <div class="variant-description" id="variant-A-description-static">
                                        Users see the standard add to cart experience when browsing products from search results. This represents the current user flow without any modifications.
                                    </div>
                                    <div class="form-group" id="variant-A-edit-fields">
                                        <label class="form-label" for="variant-A-description">Description</label>
                                        <textarea class="form-input" id="variant-A-description" rows="3"></textarea>
                                        <input type="number" class="form-input" id="variant-A-allocation" min="0" max="100" step="1" placeholder="0-100">
                                        <div class="form-error" id="variant-A-allocation-error" style="display:none;">Enter a valid number 0-100</div>
                                    </div>
                                </div>

                                <div class="variant-item variant-b">
                                    <div class="variant-header">
                                        <div class="variant-label">Variant B</div>
                                        <div class="variant-percentage" id="variant-B-allocation-static">40%</div>
                                    </div>
                                    <div class="variant-description" id="variant-B-description-static">
                                        Users experience the new one-click add to cart (1ATC) functionality when browsing products from search results, streamlining the purchase process.
                                    </div>
                                    <div class="form-group" id="variant-B-edit-fields">
                                        <label class="form-label" for="variant-B-description">Description</label>
                                        <textarea class="form-input" id="variant-B-description" rows="3"></textarea>
                                        <input type="number" class="form-input" id="variant-B-allocation" min="0" max="100" step="1" placeholder="0-100">
                                        <div class="form-error" id="variant-B-allocation-error" style="display:none;">Enter a valid number 0-100</div>
                                    </div>
                                </div>

                                <div class="variant-item variant-c">
                                    <div class="variant-header">
                                        <div class="variant-label">Variant C</div>
                                        <div class="variant-percentage" id="variant-C-allocation-static">40%</div>
                                    </div>
                                    <div class="variant-description" id="variant-C-description-static">
                                        Users get the one-click add to cart functionality plus an inline quantity selector, allowing them to add multiple items directly from search without navigating to product pages.
                                    </div>
                                    <div class="form-group" id="variant-C-edit-fields">
                                        <label class="form-label" for="variant-C-description">Description</label>
                                        <textarea class="form-input" id="variant-C-description" rows="3"></textarea>
                                        <input type="number" class="form-input" id="variant-C-allocation" min="0" max="100" step="1" placeholder="0-100">
                                        <div class="form-error" id="variant-C-allocation-error" style="display:none;">Enter a valid number 0-100</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuration Section -->
                <div class="section expanded" data-section="configuration">
                    <div class="section-header">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-.97l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.32-.07.65-.07.97s.03.66.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                            </svg>
                            Configuration
                        </h3>
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </div>
                    <div class="section-content">

                        <!-- Experiment Dates (card) -->
                        <div class="card-layout">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Experiment Dates</div>
                                    <div class="card-subtitle">Set the planned or scheduled dates for your experiment.</div>
                                </div>
                                <!-- Date Type Radios -->
                                <div class="form-grid" style="grid-template-columns: 1fr; gap: 16px; margin-top: 12px;">
                                    <div class="form-group" id="abex-date-type-group">
                                        <label class="form-label required">Experiment Date Type</label>
                                        <div class="inline-options">
                                            <div class="checkbox-group">
                                                <input type="radio" class="checkbox-input" id="abex-date-type-planned" name="abex-date-type" value="Planned" checked onchange="setAbexDateType('Planned')">
                                                <label for="abex-date-type-planned" class="checkbox-label">Planned</label>
                                            </div>
                                            <div class="checkbox-group">
                                                <input type="radio" class="checkbox-input" id="abex-date-type-scheduled" name="abex-date-type" value="Scheduled" onchange="setAbexDateType('Scheduled')">
                                                <label for="abex-date-type-scheduled" class="checkbox-label">Scheduled</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Start/End Dates -->
                                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 16px; align-items: end; margin-top: 12px;">
                                    <div class="form-group" style="display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 0;">
                                        <label class="form-label required" id="abex-start-date-label">Planned Start Date</label>
                                        <input type="date" class="form-input" id="predicted-start-date" onchange="updateABEXField('predictedStartDate', this.value)">
                                    </div>
                                    <div class="form-group" style="display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 0;">



                                        <label class="form-label required" id="abex-end-date-label">Planned End Date</label>
                                        <input type="date" class="form-input" id="predicted-end-date" onchange="updateABEXField('predictedEndDate', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Card: Experiment Type -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Experiment Type <span style="color:#dc2626">*</span></div>

                                </div>
                                <div class="form-group">
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <div class="checkbox-group">
                                            <input type="radio" class="checkbox-input" id="amp-experiment" name="experiment-type" value="amp">
                                            <div class="checkbox-content">
                                                <label for="amp-experiment" class="checkbox-label">AMP Experiment</label>
                                                <div class="option-description">Server-side experiments where the backend sends a variant-specific web component to the browser, based on the user's variant.</div>
                                            </div>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="radio" class="checkbox-input" id="server-side" name="experiment-type" value="server-side" checked>
                                            <div class="checkbox-content">
                                                <label for="server-side" class="checkbox-label">Server-side Experiment</label>
                                                <div class="option-description">Tests run on the backend, where the server uses the user's variant to decide what data or response to send back to the app. Variant information is sent to the backend via a custom HTTP header, <code>x-ab-test</code>.</div>
                                            </div>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="radio" class="checkbox-input" id="client-side" name="experiment-type" value="client-side">
                                            <div class="checkbox-content">
                                                <label for="client-side" class="checkbox-label">Client-side Experiment</label>
                                                <div class="option-description">Tests run directly in the client app (iOS, Android, or Web), where the app itself uses the users variant to decide what to show.</div>
                                            </div>
                                        </div>
                                        <!-- ABEX option intentionally excluded for ABACUS -->
                                    </div>
                                </div>
                            </div>


                                <!-- Card: Authentication Settings -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Authentication Settings</div>
                                        <div class="card-subtitle">Does the experiment require the user to be logged in?</div>
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" class="checkbox-input" id="authentication" checked>
                                            <label for="authentication" class="checkbox-label">Authentication Required</label>
                                        </div>
                                    </div>
                                </div>


                                <!-- Card: Audience Selection (Banners only) -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Banner Selection</div>
                                        <div class="card-subtitle">Define banners for targeting.</div>
                                    </div>
                                    <div class="form-group">
                                        <div class="multi-select-container" style="margin-bottom: 8px;">
                                            <select class="form-select" id="banners-select" onchange="handleBannerSelectChange(this.value); this.value='';">
                                                <option value="">Add Banner...</option>
                                            </select>
                                        </div>
                                        <div id="banners-tags" style="display:flex;flex-wrap:wrap;gap:4px;"></div>


                                    </div>
                                </div>


                                <!-- Card: User Traffic Allocation -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">User Traffic Allocation</div>
                                        <div class="card-subtitle">Specify the percentage of eligible users that can participate in the experiment.</div>
                                    </div>
                                    <div class="form-group">
                                        <input type="number" class="form-input" id="traffic-allocation" value="100" min="1" max="100" placeholder="Enter percentage between 1-100">
                                        <div class="form-error">Please enter a traffic allocation percentage between 1 and 100</div>
                                    </div>
                                </div>

                                <!-- Card: Experiment Metrics -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Experiment Metrics</div>
                                        <div class="card-subtitle">Define what success looks like for your experiment.</div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label required">Primary Metric <span style="color:#dc2626">*</span></label>
                                        <select class="form-select" id="primary-metric">
                                            <option value="">Select primary metric...</option>
                                            <option value="clicks-nav">Clicks (Nav Elements)</option>
                                            <option value="cart-adds">Cart Adds</option>
                                            <option value="orders-placed">Orders Placed</option>
                                            <option value="conversion-rate">Conversion Rate</option>
                                            <option value="revenue-per-user">Revenue Per User</option>
                                            <option value="order-revenue">Order Revenue Booked</option>
                                            <option value="page-views">Page Views</option>
                                            <option value="time-on-page">Time on Page</option>
                                            <option value="bounce-rate">Bounce Rate</option>
                                            <option value="session-duration">Session Duration</option>
                                        </select>
                                    </div>

                                    <div class="form-group" style="margin-top: 24px;">
                                        <label class="form-label">Secondary Measures/Goals</label>
                                        <div class="multi-select-container" style="margin-bottom: 8px;">
                                            <select class="form-select" id="secondary-metric-select" onchange="handleSecondaryMetricSelect(this.value); this.value='';">
                                                <option value="">Select Secondary Metric...</option>
                                            </select>
                                        </div>
                                        <div class="bubble-tags-container" id="secondary-metrics-tags" style="min-height: 24px; padding: 4px; border-radius: 4px;"></div>
                                    </div>
                                </div>


                                <!-- Card: Technical Owner -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Technical Owner</div>
                                        <div class="card-subtitle">Specify the technical contact responsible for this experiment implementation.</div>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" class="form-input" id="technical-owner" placeholder="Enter technical owner name or email" value="Alan Turing" onchange="setTechnicalOwner(this.value)">
                                    </div>
                                </div>

                        </div>



                    </div>
                </div>

                <!-- Spaces Section -->
                <div class="section expanded" data-section="spaces">
                    <div class="section-header">
                        <h3>


                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 3h18v4H3V3zm0 6h18v4H3V9zm0 6h18v4H3v-4z"/>
                            </svg>
                            Spaces
                        </h3>
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </div>
                    <div class="section-content">
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">Define the spaces where this experiment will run. Spaces help organize and prevent conflicts between experiments.</p>

                        <div class="form-group">
                            <label class="form-label">Selected Spaces</label>
                            <div class="multi-select-container" style="margin-bottom: 8px;">
                                <select class="form-select" id="spaces-select" onchange="handleSpaceSelect(this.value); this.value='';">
                                    <option value="">Select Space...</option>
                                </select>
                            </div>
                            <div class="bubble-tags-container" id="spaces-tags" style="min-height: 24px; padding: 4px; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Experiment Isolation Section -->
                <div class="section expanded" data-section="isolation">
                    <div class="section-header">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L1 21h22L12 2zm0 3.5L20.5 20h-17L12 5.5zM11 10v6h2v-6h-2zm0 8v2h2v-2h-2z"/>
                            </svg>
                            Experiment Isolation
                        </h3>
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </div>
                    <div class="section-content">
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">This experiment is assigned to a specific pool lane to ensure proper traffic isolation and prevent interference with other experiments.</p>

                        <div class="isolation-container">
                            <div class="current-assignment">
                                <h4 style="margin-bottom: 16px; color: var(--text-primary); font-size: 16px; font-weight: 600;">Pool Lane Assignment</h4>

                        <div class="assignment-card">
                            <div class="assignment-grid">
                                <div class="assignment-item">
                                    <div class="assignment-row">
                                        <span class="assignment-label">Pool:</span>
                                        <span class="assignment-value">Home & Search Experience Pool</span>
                                    </div>
                                    <div class="assignment-row">
                                        <span class="assignment-label">Pool ID:</span>
                                        <span class="assignment-value pool-id">PL-A8F3D2</span>
                                    </div>
                                    <div class="assignment-row">
                                        <span class="assignment-label">Pool Traffic:</span>
                                        <span class="assignment-value traffic-allocation">75%</span>
                                    </div>
                                </div>

                                <div class="assignment-divider"></div>

                                <div class="assignment-item">
                                    <div class="assignment-row">
                                        <span class="assignment-label">Lane:</span>
                                        <span class="assignment-value">Cart & Checkout Optimization Lane</span>
                                    </div>
                                    <div class="assignment-row">
                                        <span class="assignment-label">Lane ID:</span>
                                        <span class="assignment-value lane-id">LN-B4E9C1</span>
                                    </div>
                                    <div class="assignment-row">
                                        <span class="assignment-label">Lane Traffic:</span>
                                        <span class="assignment-value traffic-allocation">40%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                                <button id="change-pool-assignment-btn" class="btn btn-primary" style="margin-top: 16px;">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 8px;">
                                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10 2.708 2.708z"/>
                                    </svg>
                                    Change Pool Lane Assignment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Tab Content -->
        <div class="tab-content" id="results-tab">
            <div class="main-content">
                <div class="section platform-specific">
                    <div class="section-header no-toggle">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 3v18h18V3H3zm16 16H5V5h14v14z"/>
                                <path d="M7 17h2v-4H7v4zm4-6h2v6h-2v-6zm4-4h2v10h-2V7z"/>
                            </svg>
                            <span id="reporting-title">Results for iOS</span>
                        </h3>
                        <div class="platform-chips">
                            <span class="platform-chip" data-platform="web">Web</span>
                            <span class="platform-chip" data-platform="android">Android</span>
                            <span class="platform-chip active" data-platform="ios">iOS</span>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="config-grid">
                            <div class="config-item">
                                <div class="config-label">Metric</div>
                                <select class="form-select">
                                    <option value="cart-adds" selected>Cart Adds</option>
                                    <option value="click-through-rate">Click Through Rate</option>
                                    <option value="conversion-rate">Conversion Rate</option>
                                    <option value="revenue-per-user">Revenue Per User</option>
                                    <option value="time-on-page">Time on Page</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-top: 24px;">
                            <h4 style="margin-bottom: 16px; color: var(--text-primary);">Trend Chart & Performance Metrics</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 16px;">Data Source: Customer Journey Analytics</p>

                            <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                                <select class="form-input" style="width: auto; min-width: 150px;">
                                    <option>Unique Visitors</option>
                                    <option>Cart Adds</option>
                                    <option>Conversions</option>
                                </select>
                                <select class="form-input" style="width: auto; min-width: 120px;">
                                    <option>Last Week</option>
                                    <option>Last Month</option>
                                    <option>Last Quarter</option>
                                </select>
                            </div>

                            <div class="chart-container">
                                <canvas id="reportingChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Tab Content -->
        <div class="tab-content" id="notes-tab">
            <div class="main-content">
                <div class="section">
                    <div class="section-header no-toggle">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
                                <path d="M8 10h8v2H8zm0 4h8v2H8zm0 4h5v2H8z"/>
                            </svg>
                            Notes
                        </h3>
                    </div>
                    <div class="section-content">
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">Have questions or comments? Use this section to communicate with our team.</p>

                        <div class="note-item">
                            <div class="note-author">Ellie Clyde</div>
                            <div class="note-date">about 1 month ago</div>
                            <div>test</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Add a new note</label>
                            <textarea class="form-input form-textarea" placeholder="Please enter your note"></textarea>
                        </div>
                        <button class="btn btn-primary">Add Note</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources Tab Content -->
        <div class="tab-content" id="resources-tab">
            <div class="main-content">
                <div class="card-layout">
                    <!-- Card: Target URLs -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Target URLs</div>
                            <div class="card-subtitle">Specify page locations</div>
                        </div>
                        <div class="form-group">
                            <div class="multi-select-container" style="display: grid; grid-template-columns: 1fr auto; gap: 8px; margin-bottom: 8px;">
                                <input type="text" class="form-input" id="targeting-url-input" placeholder="Add URL..." onkeydown="if(event.key==='Enter'){ addTargetingUrlFromInput(); event.preventDefault(); }">
                                <button type="button" class="btn" id="add-targeting-url-btn" onclick="addTargetingUrlFromInput()">Add</button>
                            </div>
                            <div class="bubble-tags-container" id="targeting-urls-tags" style="min-height: 24px; padding: 4px; border-radius: 4px;"></div>
                        </div>
                    </div>

                    <!-- Card: Attachments -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Attachments</div>
                            <div class="card-subtitle">Upload supporting files</div>
                        </div>
                        <div class="file-upload">
                            <svg class="file-upload-icon" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                            </svg>
                            <h4 style="margin-bottom: 8px;">Drag and drop files here</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 16px;">or</p>
                            <button class="btn btn-primary">Browse Files</button>
                            <p style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">Supports JPG, PNG, MD, PDFs, and Microsoft suite files within a 40MB limit.</p>
                        </div>
                        <p style="margin-top: 16px; color: var(--text-secondary); font-style: italic;">No files have been uploaded yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Log Tab Content -->
        <div class="tab-content" id="audit-tab">
            <div class="main-content">
                <div class="section platform-specific">
                    <div class="section-header no-toggle">
                        <h3>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 3v18h18V3H3zm16 16H5V5h14v14z"/>
                                <path d="M7 7h10v2H7V7zm0 4h10v2H7v-2zm0 4h7v2H7v-2z"/>
                            </svg>
                            <span id="audit-log-title">Audit Log for iOS experiment</span>
                        </h3>
                    </div>
                    <div class="section-content">
                        <div class="audit-item">
                            <div class="audit-header">
                                <div class="audit-user">Sinha, Nikhil</div>
                                <div class="audit-date">07/10/2025, 11:15 AM</div>
                            </div>
                            <div class="audit-changes">status updated "Pending" → "Running"</div>
                        </div>

                        <div class="audit-item">
                            <div class="audit-header">
                                <div class="audit-user">Sinha, Nikhil</div>
                                <div class="audit-date">07/10/2025, 11:14 AM</div>
                            </div>
                            <div class="audit-changes">
                                readyToStart added true<br>
                                readyToStart_by added "Sinha, Nikhil"<br>
                                readyToStart_timestamp added 1752160495100
                            </div>
                        </div>

                        <div class="audit-item">
                            <div class="audit-header">
                                <div class="audit-user">Sinha, Nikhil</div>
                                <div class="audit-date">06/26/2025, 4:34 PM</div>
                            </div>
                            <div class="audit-changes">
                                status updated "In Review" → "Pending"<br>
                                allocation added "100"<br>
                                distribution added "50:50"
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Variant Selection Modal -->
    <div class="variant-override-modal" id="variant-selection-modal">
        <div class="variant-override-modal-content">
            <div class="variant-override-modal-header">
                <h3 class="variant-override-modal-title">Select Winning Variant</h3>
                <button class="variant-override-modal-close" id="close-variant-modal">×</button>
            </div>
            <div class="variant-override-content"></div>
        </div>
    </div>

    <script>
        // State management for tabs and sections
        let currentTab = 'workflow';
        let sectionStates = {
            hypothesis: true,
            variants: true,
            configuration: true,
            spaces: true,
            isolation: true,
            checklist: true
        };


        // Workflow state management
        let workflowStage = 'review'; // 'review', 'approved', 'started', 'stopped'

        // Platform data (simulated)
        const platformData = {
            web: {
                reporting: [
                    { date: '2025-07-25', variant1: 305000, variant2: 302000, variant3: 298000 },
                    { date: '2025-07-26', variant1: 285000, variant2: 281000, variant3: 275000 },
                    { date: '2025-07-27', variant1: 302000, variant2: 301000, variant3: 295000 },
                    { date: '2025-07-28', variant1: 260000, variant2: 258000, variant3: 252000 },
                    { date: '2025-07-29', variant1: 285000, variant2: 280000, variant3: 278000 },
                    { date: '2025-07-30', variant1: 335000, variant2: 328000, variant3: 325000 },
                    { date: '2025-07-31', variant1: 310000, variant2: 305000, variant3: 308000 }
                ],
                audit: [
                    { user: 'Johnson, Sarah', date: '07/11/2025, 9:45 AM', changes: 'Web configuration updated for A/B/C test parameters' },
                    { user: 'Chen, David', date: '07/10/2025, 3:20 PM', changes: 'Web analytics tracking configured' }
                ]
            },
            android: {
                reporting: [
                    { date: '2025-07-25', variant1: 285000, variant2: 290000, variant3: 288000 },
                    { date: '2025-07-26', variant1: 275000, variant2: 278000, variant3: 276000 },
                    { date: '2025-07-27', variant1: 292000, variant2: 295000, variant3: 293000 },
                    { date: '2025-07-28', variant1: 255000, variant2: 260000, variant3: 258000 },
                    { date: '2025-07-29', variant1: 280000, variant2: 285000, variant3: 283000 },
                    { date: '2025-07-30', variant1: 320000, variant2: 325000, variant3: 322000 },
                    { date: '2025-07-31', variant1: 300000, variant2: 310000, variant3: 305000 }
                ],
                audit: [
                    { user: 'Anderson, Mike', date: '07/09/2025, 2:30 PM', changes: 'Android build deployed v2.1.3' },
                    { user: 'Chen, Li', date: '07/08/2025, 10:15 AM', changes: 'Android configuration updated' }
                ]
            },
            ios: {
                reporting: [
                    { date: '2025-07-25', variant1: 295000, variant2: 288000, variant3: 285000 },
                    { date: '2025-07-26', variant1: 280000, variant2: 275000, variant3: 272000 },
                    { date: '2025-07-27', variant1: 298000, variant2: 292000, variant3: 290000 },
                    { date: '2025-07-28', variant1: 265000, variant2: 258000, variant3: 255000 },
                    { date: '2025-07-29', variant1: 290000, variant2: 282000, variant3: 280000 },
                    { date: '2025-07-30', variant1: 330000, variant2: 320000, variant3: 318000 },
                    { date: '2025-07-31', variant1: 315000, variant2: 308000, variant3: 305000 }
                ],
                audit: [
                    { user: 'Sinha, Nikhil', date: '07/10/2025, 11:15 AM', changes: 'status updated "Pending" → "Running"' },
                    { user: 'Sinha, Nikhil', date: '07/10/2025, 11:14 AM', changes: 'readyToStart added true\nreadyToStart_by added "Sinha, Nikhil"' }
                ]
            }
        };

        let currentPlatform = 'ios';
        let reportingChart = null;
        let variantsPieChart = null;

        // NEW: Variant selection data
        const variantLabels = {
            'A': 'Current Experience',
            'B': 'New 1ATC Experience',
            'C': 'Enhanced 1ATC'
        };

        // Initialize the app
        function init() {
            // Set default dates and metrics before any mode/UI toggles
            if (typeof initializeDefaultDates === 'function') initializeDefaultDates();

            setupEventListeners();
            updateSectionStates();
            updatePlatformSpecificContent();
            initCharts();
            // Initialize banner multi-select (bubbles + dropdown)
            renderBannersBubbleTags();
            renderBannerSelectOptions();
            // Initialize secondary metrics multi-select (bubbles + dropdown)
            renderSecondaryMetricsBubbleTags();
            renderSecondaryMetricOptions();
            // Initialize spaces multi-select (bubbles + dropdown)
            if (typeof renderSpacesBubbleTags === 'function') renderSpacesBubbleTags();
            if (typeof renderSpaceOptions === 'function') renderSpaceOptions();
            // Legacy banner checkbox toggle will no-op if elements are absent
            setupBannerToggle();
            // Apply default metrics after initial render so dropdown reflects selections
            if (typeof initializeDefaultMetrics === 'function') initializeDefaultMetrics();
            // Apply default spaces after initial render so dropdown reflects selections
            if (typeof initializeDefaultSpaces === 'function') initializeDefaultSpaces();

            setupSubscriptionToggle();

            setupWorkflowButtons();
            matchPieChartHeight();
            // Start in view mode by default (Edit available in header)
            if (typeof enterReadMode === 'function') enterReadMode();
            if (typeof updateTabActionsVisibility === 'function') updateTabActionsVisibility();

        }


        // Banner names to match wizard (canonical 18-option list)
        const bannerNames = [
            'All Banners',
            "Kroger", "Baker's", "City Market", "Dillons", "Food 4 Less", "Foods Co",
            "Fred Meyer", "Fry's", "Gerbes", "Harris Teeter", "Jay C", "King Soopers",
            "Mariano's", "Metro Market", "Owen's", "Pay Less", "Pick 'n Save"
        ];

        // ABACUS configuration (local) for selections
        const abacusConfig = {
            banners: ['All Banners'],
            secondaryMetrics: [],
            selectedSpaces: [],
            targetingUrls: [],
            technicalOwner: 'Alan Turing',
            primaryMetric: '',
            trafficAllocation: 100,
            authenticationRequired: true,
            predictedStartDate: '',
            predictedEndDate: '',
            abexDateType: 'Planned',
            hypothesis: 'By implementing a streamlined one-click add to cart experience from search results, we expect to see increased conversion rates and reduced cart abandonment as users can more quickly and easily add products to their cart without additional navigation steps.',
            // Variants config for edit/view in Configuration tab
            variants: [
                {
                    key: 'A',
                    label: 'A — Current add to cart experience from search',
                    description: 'Users see the standard add to cart experience when browsing products from search results. This represents the current user flow without any modifications.',
                    allocation: 20
                },
                {
                    key: 'B',
                    label: 'B — New 1ATC experience from search',
                    description: 'Users experience the new one-click add to cart (1ATC) functionality when browsing products from search results, streamlining the purchase process.',
                    allocation: 40
                },
                {
                    key: 'C',
                    label: 'C — Enhanced 1ATC with quantity selector',
                    description: 'Users get the one-click add to cart functionality plus an inline quantity selector, allowing them to add multiple items directly from search without navigating to product pages.',
                    allocation: 40
                }
            ]
        };

        function setTechnicalOwner(value) {
            abacusConfig.technicalOwner = (value || '').trim();
        }

        function setAbexDateType(val) {
            abacusConfig.abexDateType = val;
            const startLabel = document.getElementById('abex-start-date-label');
            const endLabel = document.getElementById('abex-end-date-label');

        // Mirror ABEX inline onchange handler contract
        function updateABEXField(field, value) {
            if (!abacusConfig) return;
            abacusConfig[field] = value;
        }

            if (startLabel) startLabel.textContent = `${val} Start Date`;
            if (endLabel) endLabel.textContent = `${val} End Date`;
        }

        // Date helpers
        function formatDateISO(d) {
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${y}-${m}-${day}`;
        }
        function daysInMonth(year, monthIndex /* 0-11 */) {
            return new Date(year, monthIndex + 1, 0).getDate();
        }
        function addMonthsClamped(date, months) {
            const originalDay = date.getDate();
            // Move to first of month to avoid auto-overflow
            const t = new Date(date.getFullYear(), date.getMonth(), 1);
            t.setMonth(t.getMonth() + months);
            const dim = daysInMonth(t.getFullYear(), t.getMonth());
            t.setDate(Math.min(originalDay, dim));
            return t;
        }
        function initializeDefaultDates() {
            try {
                const startInput = document.getElementById('predicted-start-date');
                const endInput = document.getElementById('predicted-end-date');
                if (!startInput || !endInput) return;
                const today = new Date();
                if (!startInput.value) {
                    const startStr = formatDateISO(today);
                    startInput.value = startStr;
                    abacusConfig.predictedStartDate = startStr;
                }
                if (!endInput.value) {


                    const oneMonth = addMonthsClamped(today, 1);

                    const endStr = formatDateISO(oneMonth);
                    endInput.value = endStr;
                    abacusConfig.predictedEndDate = endStr;
                }
            } catch (e) { console.warn('Default date init failed', e); }
        }


        // Edit/View mode state
        let isReadOnlyMode = false;

        function ensureDisplayAfter(el, id, className) {
            if (!el || !el.parentNode) return null;
            let disp = document.getElementById(id);
            if (!disp) {
                disp = document.createElement('div');
                disp.id = id;
                if (className) disp.className = className;
                el.parentNode.insertBefore(disp, el.nextSibling);
            }
            return disp;
        }

        function applyReadOnlyUI() {
            isReadOnlyMode = true;
            // Hide red asterisk required indicators in View Mode (Configuration tab)
            document.querySelectorAll('#configuration-tab span[style*="color:#dc2626"]').forEach(el => { el.style.visibility = 'hidden'; });

            // Authentication (View Mode): keep visible but disable interaction
            const auth = document.getElementById('authentication');
            if (auth) {
                auth.style.display = '';
                auth.setAttribute('disabled', 'true');
            }
            // Hypothesis (View Mode): hide textarea, show static text
            (function(){
                const hypArea = document.getElementById('hypothesis-textarea');
                const hypStatic = document.getElementById('hypothesis-static');
                if (hypArea) hypArea.style.display = 'none';
                if (hypStatic) {
                    hypStatic.style.display = '';
                    const text = (abacusConfig && typeof abacusConfig.hypothesis === 'string') ? abacusConfig.hypothesis : (hypArea ? hypArea.value : (hypStatic.textContent || ''));
                    hypStatic.textContent = (text || '').trim() || '—';
                }
            })();
            // Traffic allocation
            const traffic = document.getElementById('traffic-allocation');
            if (traffic) {
                traffic.style.display = 'none';
                const disp = ensureDisplayAfter(traffic, 'traffic-allocation-static');
                if (disp) { disp.style.display = ''; disp.textContent = `${traffic.value || '—'}%`; }
            }
            // Primary metric
            const primary = document.getElementById('primary-metric');
            if (primary) {
                primary.style.display = 'none';
                const disp = ensureDisplayAfter(primary, 'primary-metric-static');
                if (disp) {
                    const text = primary.options[primary.selectedIndex]?.text || '';
                    disp.style.display = '';
                    if (text) {
                        disp.textContent = text;
                        disp.style.color = '';
                        disp.style.fontStyle = '';
                    } else {
                        // View Mode should avoid dropdown placeholders; show a clean fallback
                        disp.textContent = 'Not selected';
                        disp.style.color = 'var(--text-secondary)';
                        disp.style.fontStyle = 'italic';
                    }
                }
            }
            // Secondary metrics: hide select, render non-removable tags
            const secSel = document.getElementById('secondary-metric-select');
            if (secSel) secSel.style.display = 'none';
            renderSecondaryMetricsBubbleTags();
            // Selected spaces: hide select, render non-removable tags
            const spSelRO = document.getElementById('spaces-select');
            if (spSelRO) spSelRO.style.display = 'none';
            if (typeof renderSpacesBubbleTags === 'function') renderSpacesBubbleTags();
            // Banners: hide select, render non-removable tags
            const banSel = document.getElementById('banners-select');
            if (banSel) banSel.style.display = 'none';
            renderBannersBubbleTags();
            // Technical owner
            const tech = document.getElementById('technical-owner');
            if (tech) {
                tech.style.display = 'none';
                const disp = ensureDisplayAfter(tech, 'technical-owner-static');
                if (disp) { disp.style.display = ''; disp.textContent = tech.value || '—'; }
            }
            // Hide any instructional/error text in View Mode (e.g., labels starting with "Please ...")
            document.querySelectorAll('#configuration-tab .form-error').forEach(el => { (el).style.display = 'none'; });
            // Dates
            const dtGrp = document.getElementById('abex-date-type-group');
            // Experiment Type: hide radio container, show static
            (function() {
                const map = { 'amp': 'AMP', 'server-side': 'Server-side', 'client-side': 'Client-side' };

                const radios = Array.from(document.querySelectorAll('input[name="experiment-type"]'));
                if (radios.length === 0) return;
                const checked = radios.find(r => r.checked) || radios[0];

                const displayText = map[checked.value] || checked.value || '—';
                const formGroup = radios[0].closest('.form-group');
                const wrapper = formGroup ? formGroup.firstElementChild : null; // the flex column that wraps all checkbox-group
                if (wrapper) wrapper.style.display = 'none';
                // Place static text after the wrapper so it's not hidden
                const disp = ensureDisplayAfter(wrapper || radios[0], 'experiment-type-static');
                if (disp) { disp.style.display = ''; disp.textContent = displayText; }
            })();

            if (dtGrp) dtGrp.style.display = 'none';
            const start = document.getElementById('predicted-start-date');
            if (start) { start.style.display = 'none'; const d = ensureDisplayAfter(start, 'predicted-start-date-static'); if (d) { d.style.display=''; d.textContent = start.value || '—'; } }
            const end = document.getElementById('predicted-end-date');
            if (end) { end.style.display = 'none'; const d = ensureDisplayAfter(end, 'predicted-end-date-static'); if (d) { d.style.display=''; d.textContent = end.value || '—'; } }
            // Variants (View Mode): hide labels/inputs, show static, style percentage prominently
            (Array.isArray(abacusConfig.variants) ? abacusConfig.variants.map(v => v.key) : []).forEach(function(k){
                const v = (abacusConfig.variants || []).find(x => x.key === k) || {};
                const editGroup = document.getElementById(`variant-${k}-edit-fields`);
                const descInput = document.getElementById(`variant-${k}-description`);
                const allocInput = document.getElementById(`variant-${k}-allocation`);
                const descStatic = document.getElementById(`variant-${k}-description-static`);
                const allocStatic = document.getElementById(`variant-${k}-allocation-static`);
                // Hide the entire edit group (labels + inputs) in View Mode
                if (editGroup) editGroup.style.display = 'none';
                if (descInput) descInput.style.display = 'none';
                if (allocInput) allocInput.style.display = 'none';
                // Show static values
                if (descStatic) { descStatic.style.display=''; descStatic.textContent = (v.description || '').trim() || '\u2014'; }
                if (allocStatic) {
                    allocStatic.style.display='';
                    allocStatic.textContent = (typeof v.allocation === 'number' ? v.allocation : parseInt((allocInput && allocInput.value) || '0',10) || 0) + '%';
                    // Make percentage more prominent in View Mode
                    allocStatic.style.fontSize = '1.25rem';
                    allocStatic.style.fontWeight = '700';
                    allocStatic.style.color = '#ffffff';
                }
            });
            const addBtn = document.getElementById('variants-add-btn'); if (addBtn) addBtn.style.display = 'none';

            // Change Pool Assignment button (View Mode): disable button
            const poolBtn = document.getElementById('change-pool-assignment-btn');
            if (poolBtn) {
                poolBtn.disabled = true;
                poolBtn.classList.add('disabled');
            }

        }

        function applyEditUI() {
            isReadOnlyMode = false;
            // Authentication (Edit Mode): keep visible and re-enable interaction
            const auth = document.getElementById('authentication');
            if (auth) { auth.style.display = ''; auth.removeAttribute('disabled'); }
            // Hypothesis (Edit Mode): show textarea, hide static, populate from config
            (function(){
                const hypArea = document.getElementById('hypothesis-textarea');
                const hypStatic = document.getElementById('hypothesis-static');
                if (hypArea) {
                    hypArea.style.display = '';
                    const val = (abacusConfig && typeof abacusConfig.hypothesis === 'string') ? abacusConfig.hypothesis : (hypStatic ? hypStatic.textContent : '');
                    hypArea.value = (val || '').trim();
                }
                if (hypStatic) hypStatic.style.display = 'none';
            })();
            // Traffic
            const traffic = document.getElementById('traffic-allocation'); if (traffic) traffic.style.display = '';
            const trafficDisp = document.getElementById('traffic-allocation-static'); if (trafficDisp) trafficDisp.style.display = 'none';
            // Primary metric
            const primary = document.getElementById('primary-metric'); if (primary) primary.style.display = '';
            const primaryDisp = document.getElementById('primary-metric-static'); if (primaryDisp) primaryDisp.style.display = 'none';
            // Secondary metrics select
            const secSel = document.getElementById('secondary-metric-select'); if (secSel) secSel.style.display = '';
            // Selected spaces select
            // Experiment Type: show radio container, hide static
            (function() {
                const radios = Array.from(document.querySelectorAll('input[name="experiment-type"]'));
                if (radios.length === 0) return;
                const formGroup = radios[0].closest('.form-group');
                const wrapper = formGroup ? formGroup.firstElementChild : null;
                if (wrapper) wrapper.style.display = '';
                const disp = document.getElementById('experiment-type-static');
                if (disp) disp.style.display = 'none';
            })();
            const spSel = document.getElementById('spaces-select'); if (spSel) spSel.style.display = '';
            // Banners select
            // Show instructional/error text again in Edit Mode
            document.querySelectorAll('#configuration-tab .form-error').forEach(el => { (el).style.display = ''; });
            const banSel = document.getElementById('banners-select'); if (banSel) banSel.style.display = '';
            // Technical owner
            const tech = document.getElementById('technical-owner'); if (tech) tech.style.display = '';
            const techDisp = document.getElementById('technical-owner-static'); if (techDisp) techDisp.style.display = 'none';
            // Dates
            const dtGrp = document.getElementById('abex-date-type-group'); if (dtGrp) dtGrp.style.display = '';
            const sDisp = document.getElementById('predicted-start-date-static'); if (sDisp) sDisp.style.display = 'none';
            const eDisp = document.getElementById('predicted-end-date-static'); if (eDisp) eDisp.style.display = 'none';
            const startInput = document.getElementById('predicted-start-date');
            if (startInput) {
                startInput.style.display = '';
                startInput.value = abacusConfig.predictedStartDate || '';
            }
            const endInput = document.getElementById('predicted-end-date');
            if (endInput) {
                endInput.style.display = '';
                endInput.value = abacusConfig.predictedEndDate || '';
            }
            // Re-render tags to show remove buttons
            renderSecondaryMetricsBubbleTags();
            if (typeof renderSpacesBubbleTags === 'function') renderSpacesBubbleTags();
            renderBannersBubbleTags();
            // Variants (Edit Mode): show inputs, hide static, populate from config
            (typeof computeVariantKeysFromDOM === 'function' ? computeVariantKeysFromDOM() : (Array.isArray(abacusConfig.variants) ? abacusConfig.variants.map(v=>v.key) : [])).forEach(function(k){
                const v = (abacusConfig.variants || []).find(x => x.key === k) || {};
                const editGroup = document.getElementById(`variant-${k}-edit-fields`);
                const descInput = document.getElementById(`variant-${k}-description`);
                const allocInput = document.getElementById(`variant-${k}-allocation`);
                const descStatic = document.getElementById(`variant-${k}-description-static`);
                const allocStatic = document.getElementById(`variant-${k}-allocation-static`);
                // Show the entire edit group (labels + inputs) in Edit Mode
                if (editGroup) editGroup.style.display = '';
                if (descStatic) descStatic.style.display = 'none';
                if (allocStatic) { allocStatic.style.display = 'none'; allocStatic.style.fontSize=''; allocStatic.style.fontWeight=''; allocStatic.style.color=''; }
                if (descInput) { descInput.style.display = ''; if (typeof v.description === 'string') descInput.value = v.description; }
                if (allocInput) { allocInput.style.display = ''; if (typeof v.allocation === 'number') allocInput.value = String(v.allocation); }
                const perErr = document.getElementById(`variant-${k}-allocation-error`); if (perErr) perErr.style.display = 'none';
            });
            const variantsErr = document.getElementById('variants-error'); if (variantsErr) variantsErr.style.display = 'none';
            const addBtn2 = document.getElementById('variants-add-btn'); if (addBtn2) addBtn2.style.display = '';

            // Change Pool Assignment button (Edit Mode): enable button
            const poolBtn = document.getElementById('change-pool-assignment-btn');
            if (poolBtn) {
                poolBtn.disabled = false;
                poolBtn.classList.remove('disabled');
            }
        }

        function enterReadMode() {


            const cancelBtn = document.getElementById('config-cancel-btn');
            const primaryBtn = document.getElementById('config-update-btn');
            if (cancelBtn) cancelBtn.style.display = 'none';
            if (primaryBtn) { primaryBtn.textContent = 'Edit'; primaryBtn.onclick = enterEditMode; }
            applyReadOnlyUI();
            updateTabActionsVisibility();
        }

        function enterEditMode() {
            const cancelBtn = document.getElementById('config-cancel-btn');
            const primaryBtn = document.getElementById('config-update-btn');
            if (cancelBtn) cancelBtn.style.display = '';
            if (primaryBtn) { primaryBtn.textContent = 'Update'; primaryBtn.onclick = saveEdits; }
            applyEditUI();
            updateTabActionsVisibility();
        }

        function saveEdits() {
            // Sync from DOM to config
            const primary = document.getElementById('primary-metric');
            if (primary) abacusConfig.primaryMetric = primary.value || '';
            const traffic = document.getElementById('traffic-allocation');
            if (traffic) abacusConfig.trafficAllocation = parseInt(traffic.value || '0', 10) || 0;
            const auth = document.getElementById('authentication');
            if (auth) abacusConfig.authenticationRequired = !!auth.checked;
            const start = document.getElementById('predicted-start-date'); if (start) abacusConfig.predictedStartDate = start.value || '';
            const end = document.getElementById('predicted-end-date'); if (end) abacusConfig.predictedEndDate = end.value || '';
            // Technical owner already synced by handler, but ensure latest
            const tech = document.getElementById('technical-owner'); if (tech) abacusConfig.technicalOwner = (tech.value || '').trim();
            // Hypothesis
            (function(){
                const hypArea = document.getElementById('hypothesis-textarea');
                if (hypArea) abacusConfig.hypothesis = (hypArea.value || '').trim();
                const hypStatic = document.getElementById('hypothesis-static');
                if (hypStatic) hypStatic.textContent = (abacusConfig.hypothesis || '\u2014');
            })();
            // Variants: validate and save
            (function(){
                const existing = Array.isArray(abacusConfig.variants) ? abacusConfig.variants : [];
                const byKey = (k) => existing.find(v => v.key === k) || {};
                const domKeys = (typeof computeVariantKeysFromDOM === 'function') ? computeVariantKeysFromDOM() : [];
                const keys = domKeys.length ? domKeys : (Array.isArray(abacusConfig.variants) ? abacusConfig.variants.map(v=>v.key) : []);
                let sum = 0; let invalid = false; const next = [];
                // Hide aggregate error initially
                const aggErr = document.getElementById('variants-error'); if (aggErr) aggErr.style.display = 'none';
                keys.forEach(k => {
                    const descInput = document.getElementById(`variant-${k}-description`);
                    const allocInput = document.getElementById(`variant-${k}-allocation`);
                    const perErr = document.getElementById(`variant-${k}-allocation-error`);
                    if (perErr) perErr.style.display = 'none';
                    const labelEl = document.querySelector(`.variant-${k.toLowerCase()} .variant-label`);
                    const label = labelEl ? labelEl.textContent.trim() : (byKey(k).label || k);
                    const desc = (descInput && descInput.value ? descInput.value.trim() : (byKey(k).description || ''));
                    const allocRaw = allocInput ? allocInput.value : '';
                    const alloc = parseInt(allocRaw, 10);
                    const isNum = Number.isFinite(alloc);
                    if (!isNum || alloc < 0 || alloc > 100) {
                        if (perErr) perErr.style.display = '';
                        invalid = true;
                    } else {
                        sum += alloc;
                    }
                    next.push({ key: k, label, description: desc, allocation: isNum ? alloc : 0 });
                });
                if (invalid || sum !== 100) {
                    if (aggErr) aggErr.style.display = '';
                    // Do not leave edit mode on validation failure
                    throw new Error('Variant allocation validation failed');
                }
                abacusConfig.variants = next;
                // Update static display nodes now so View Mode shows latest values
                keys.forEach(k => {
                    const v = next.find(x => x.key === k) || {};
                    const descStatic = document.getElementById(`variant-${k}-description-static`);
                    const allocStatic = document.getElementById(`variant-${k}-allocation-static`);
                    if (descStatic) descStatic.textContent = (v.description || '').trim() || '\u2014';
                    if (allocStatic) allocStatic.textContent = (typeof v.allocation === 'number' ? v.allocation : 0) + '%';
                });
            })();

            enterReadMode();
        }

        function cancelEdits() {
            // Revert DOM from config for fields we track
            const primary = document.getElementById('primary-metric');
            if (primary && abacusConfig.primaryMetric !== undefined) primary.value = abacusConfig.primaryMetric;
            const traffic = document.getElementById('traffic-allocation');
            if (traffic && abacusConfig.trafficAllocation !== undefined) traffic.value = abacusConfig.trafficAllocation;
            const auth = document.getElementById('authentication');
            if (auth && abacusConfig.authenticationRequired !== undefined) auth.checked = !!abacusConfig.authenticationRequired;
            const start = document.getElementById('predicted-start-date'); if (start) start.value = abacusConfig.predictedStartDate || '';
            const end = document.getElementById('predicted-end-date'); if (end) end.value = abacusConfig.predictedEndDate || '';
            const tech = document.getElementById('technical-owner'); if (tech) tech.value = abacusConfig.technicalOwner || '';
            // Hypothesis: revert textarea from config
            (function(){
                const hypArea = document.getElementById('hypothesis-textarea');
                if (hypArea) hypArea.value = (abacusConfig && typeof abacusConfig.hypothesis === 'string') ? abacusConfig.hypothesis : '';
                const hypStatic = document.getElementById('hypothesis-static');
                if (hypStatic) hypStatic.textContent = (abacusConfig && typeof abacusConfig.hypothesis === 'string' && abacusConfig.hypothesis.trim()) ? abacusConfig.hypothesis : '\u2014';
            })();
            // Variants: revert inputs from config and clear errors
            (function(){
                const existing = Array.isArray(abacusConfig.variants) ? abacusConfig.variants : [];
                const configKeys = existing.map(v => v.key);
                const domKeys = (typeof computeVariantKeysFromDOM === 'function') ? computeVariantKeysFromDOM() : [];
                // Remove any unsaved variants that are not in config
                // Remove any variant marked as unsaved
                document.querySelectorAll('.variants-list [data-unsaved="true"]').forEach(item => {
                    if (item.parentElement) item.parentElement.removeChild(item);
                });
                // Also remove any variants that exist in DOM but not in config
                domKeys.filter(k => !configKeys.includes(k)).forEach(k => {
                    const item = document.querySelector(`.variants-list .variant-${k.toLowerCase()}`);
                    if (item && item.parentElement && !item.hasAttribute('data-unsaved')) item.parentElement.removeChild(item);
                });
                // Revert existing variants' inputs from config and clear errors
                configKeys.forEach(k => {
                    const v = existing.find(x => x.key === k) || {};
                    const descInput = document.getElementById(`variant-${k}-description`);
                    const allocInput = document.getElementById(`variant-${k}-allocation`);
                    if (descInput) descInput.value = v.description || '';
                    if (allocInput) allocInput.value = (typeof v.allocation === 'number' ? String(v.allocation) : '');
                    const perErr = document.getElementById(`variant-${k}-allocation-error`); if (perErr) perErr.style.display = 'none';
                });
                const aggErr = document.getElementById('variants-error'); if (aggErr) aggErr.style.display = 'none';
            })();
            enterReadMode();
        }

        function updateTabActionsVisibility() {
            const actions = document.getElementById('global-config-actions');
            if (!actions) return;
            // Reserve space to prevent tabs from shifting; toggle visibility only


            actions.style.visibility = (currentTab === 'configuration') ? 'visible' : 'hidden';
        }


        // Banner Multi-Select (dropdown + bubble tags)
            // Variants: revert inputs from config and clear errors
            (function(){
                const keys = ['A','B','C'];
                const existing = Array.isArray(abacusConfig.variants) ? abacusConfig.variants : [];
                keys.forEach(k => {
                    const v = existing.find(x => x.key === k) || {};
                    const descInput = document.getElementById(`variant-${k}-description`);
                    const allocInput = document.getElementById(`variant-${k}-allocation`);
                    if (descInput) descInput.value = v.description || '';
                    if (allocInput) allocInput.value = (typeof v.allocation === 'number' ? String(v.allocation) : '');
                    const perErr = document.getElementById(`variant-${k}-allocation-error`); if (perErr) perErr.style.display = 'none';
                });
                const aggErr = document.getElementById('variants-error'); if (aggErr) aggErr.style.display = 'none';
            })();



        function renderBannerSelectOptions() {
            const select = document.getElementById('banners-select');
            if (!select) return;
            const selected = abacusConfig.banners || [];
            const options = ['<option value="">Add Banner...</option>']
                .concat(bannerNames
                    .filter(name => !selected.includes(name))
                    .map(name => `<option value="${name}">${name}</option>`));
            select.innerHTML = options.join('');
            select.disabled = options.length <= 1; // only placeholder
        }
        function renderBannersBubbleTags() {
            const container = document.getElementById('banners-tags');
            if (!container) return;
            const banners = abacusConfig.banners || [];
            container.innerHTML = (banners || []).map(b => {
                const removeBtn = isReadOnlyMode ? '' : `<button type="button" data-b="${b}" onclick="removeBanner(this.dataset.b)" style="margin-left:6px;background:transparent;border:none;color:#fff;cursor:pointer;font-weight:700;">×</button>`;
                return `
                <span style="display:inline-flex;align-items:center;background:var(--accent-blue);color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;margin:2px;">
                    <span>${b}</span>
                    ${removeBtn}
                </span>`;
            }).join('');
            renderBannerSelectOptions();
        }
        function addBanner(name) {
            const value = (name || '').trim();
            if (!value) return;
            const isAll = value.toLowerCase() === 'all banners';
            if (isAll) {


                abacusConfig.banners = ['All Banners'];
            } else {
                abacusConfig.banners = (abacusConfig.banners || []).filter(b => b.toLowerCase() !== 'all banners');
                if (!abacusConfig.banners.includes(value)) abacusConfig.banners.push(value);
            }
            renderBannersBubbleTags();
        }
        function removeBanner(name) {
            abacusConfig.banners = (abacusConfig.banners || []).filter(b => b !== name);
            if (!abacusConfig.banners.length) abacusConfig.banners = ['All Banners'];
            renderBannersBubbleTags();
        }
        function handleBannerSelectChange(value) {
            if (!value) return;
            addBanner(value);
        }

        function matchPieChartHeight() {
            const variantsList = document.querySelector('.variants-list');
            const pieChartContainer = document.querySelector('.pie-chart-container');

            if (variantsList && pieChartContainer) {
                const variantsHeight = variantsList.offsetHeight;
                pieChartContainer.style.height = variantsHeight + 'px';
            }
        }


        // Secondary Metrics (multi-entry) helpers
        const predefinedSecondaryMetrics = [
            'Orders Placed',
            'Page Views',
            'Clicks (Nav Elements)',
            'Order Revenue Booked',
            'Cart Adds',
            'Conversion Rate',
            'Revenue Per User',
            'Time on Page'
        ];
        function renderSecondaryMetricsBubbleTags() {
            const container = document.getElementById('secondary-metrics-tags');
            if (!container) return;
            const metrics = abacusConfig.secondaryMetrics || [];
            container.innerHTML = (metrics || []).map(m => {
                const removeBtn = isReadOnlyMode ? '' : `<button type="button" data-m="${m}" onclick="removeSecondaryMetric(this.dataset.m)" style="margin-left:6px;background:transparent;border:none;color:#fff;cursor:pointer;font-weight:700;">×</button>`;
                return `
                <span style="display:inline-flex;align-items:center;background:var(--accent-blue);color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;margin:2px;">
                    <span>${m}</span>
                    ${removeBtn}
                </span>`;
            }).join('');
            renderSecondaryMetricOptions();
        }
        function renderSecondaryMetricOptions() {
            const select = document.getElementById('secondary-metric-select');
            if (!select) return;
            const selected = abacusConfig.secondaryMetrics || [];
            const options = ['<option value="">Select Secondary Metric...</option>'];
            predefinedSecondaryMetrics.forEach(name => {
                if (!selected.includes(name)) {
                    options.push(`<option value="${name}">${name}</option>`);
                }
            });
            select.innerHTML = options.join('');


            select.disabled = options.length <= 1;
        }
        function addSecondaryMetric(name) {
            const value = (name || '').trim();
            if (!value) return;
            abacusConfig.secondaryMetrics = abacusConfig.secondaryMetrics || [];
            if (!abacusConfig.secondaryMetrics.includes(value)) {
                abacusConfig.secondaryMetrics.push(value);
            }
            renderSecondaryMetricsBubbleTags();
        }
        function removeSecondaryMetric(name) {
            abacusConfig.secondaryMetrics = (abacusConfig.secondaryMetrics || []).filter(m => m !== name);
            renderSecondaryMetricsBubbleTags();
        }
        function handleSecondaryMetricSelect(value) {
            if (!value) return;
            addSecondaryMetric(value);
        }


        // Resources: Target URLs helpers (ABACUS)
        function renderTargetingUrlsBubbleTags() {
            const container = document.getElementById('targeting-urls-tags');
            if (!container) return;
            const urls = abacusConfig.targetingUrls || [];
            container.innerHTML = (urls || []).map(u => `
                <span style="display:inline-flex;align-items:center;background:var(--accent-blue);color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;margin:2px;">
                    <span>${u}</span>
                    <button type="button" data-url="${u}" onclick="removeTargetingUrl(this.dataset.url)" style="margin-left:6px;background:transparent;border:none;color:#fff;cursor:pointer;font-weight:700;">×</button>
                </span>
            `).join('');
        }
        function addTargetingUrl(url) {
            const value = (url || '').trim();
            if (!value) return;
            abacusConfig.targetingUrls = abacusConfig.targetingUrls || [];
            if (!abacusConfig.targetingUrls.includes(value)) {
                abacusConfig.targetingUrls.push(value);
                renderTargetingUrlsBubbleTags();
            }
        }
        function removeTargetingUrl(url) {
            abacusConfig.targetingUrls = (abacusConfig.targetingUrls || []).filter(u => u !== url);
            renderTargetingUrlsBubbleTags();
        }
        function addTargetingUrlFromInput() {
            const input = document.getElementById('targeting-url-input');
            if (!input) return;
            const v = (input.value || '').trim();
            if (v) addTargetingUrl(v);
            input.value = '';
        }


        // Initialize default metrics (primary + two secondary) if none set
        function initializeDefaultMetrics() {
            try {
                // Primary metric default: Conversion Rate
                const primarySel = document.getElementById('primary-metric');
                if (primarySel) {
                    if (!abacusConfig.primaryMetric) {
                        // Prefer 'conversion-rate' if present in options
                        const desired = 'conversion-rate';
                        const hasOption = Array.from(primarySel.options).some(o => o.value === desired);
                        if (hasOption) {
                            primarySel.value = desired;
                            abacusConfig.primaryMetric = desired;
                        }
                    } else {
                        // Sync DOM to config if config already set
                        primarySel.value = abacusConfig.primaryMetric;
                    }
                }

                // Secondary metrics defaults: Page Views, Cart Adds
                const defaults = ['Page Views', 'Cart Adds'];
                abacusConfig.secondaryMetrics = abacusConfig.secondaryMetrics || [];


                if (abacusConfig.secondaryMetrics.length === 0) {
                    // Set config directly then render (ensures dropdown options are filtered)
                    abacusConfig.secondaryMetrics = defaults.slice();
                    if (typeof renderSecondaryMetricsBubbleTags === 'function') renderSecondaryMetricsBubbleTags();
                    if (typeof renderSecondaryMetricOptions === 'function') renderSecondaryMetricOptions();
                } else {
                    // Ensure UI reflects any pre-existing config
                    if (typeof renderSecondaryMetricsBubbleTags === 'function') renderSecondaryMetricsBubbleTags();
                    if (typeof renderSecondaryMetricOptions === 'function') renderSecondaryMetricOptions();
                }
            } catch (e) { console.warn('Default metrics init failed', e); }
        }

        function setupEventListeners() {
            // Environment tab switching
            document.querySelectorAll('.environment-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const environment = e.target.dataset.environment;
                    switchEnvironment(environment);
                });
            });

            // Tab switching
            document.querySelectorAll('.tab-item').forEach(tab => {


                tab.addEventListener('click', (e) => {
                    const tabName = e.target.closest('.tab-item').dataset.tab;
                    switchTab(tabName);
                });
            });

            // Platform switching


            document.querySelectorAll('.platform-chip').forEach(chip => {


                chip.addEventListener('click', (e) => {
                    const platform = e.target.closest('.platform-chip').dataset.platform;
                    switchPlatform(platform);
                });
            // Variants helpers
            function computeVariantKeysFromDOM() {
                const inputs = Array.from(document.querySelectorAll('.variants-list [id^="variant-"][id$="-description"]'));
                return inputs.map(el => {
                    const m = el.id.match(/^variant-([A-Z]+)-description$/); return m ? m[1] : null;
                }).filter(Boolean);
            }
            function getConfigVariantKeys() {
                return Array.isArray(abacusConfig.variants) ? abacusConfig.variants.map(v => v.key) : [];
            }
            function nextVariantKey(existingKeys) {
                const max = 10; // A..J
                for (let i = 0; i < max; i++) {
                    const k = String.fromCharCode(65 + i);
                    if (!existingKeys.includes(k)) return k;
                }
                return null;
            }
            function createVariantRowHTML(k, labelText) {
                const lower = k.toLowerCase();
                return `
                <div class="variant-item variant-${lower}">
                    <div class="variant-header">
                        <div class="variant-label">${labelText}</div>
                        <div class="variant-percentage" id="variant-${k}-allocation-static">0%</div>
                    </div>
                    <div class="variant-description" id="variant-${k}-description-static">\u2014</div>
                    <div class="form-group" id="variant-${k}-edit-fields">
                        <label class="form-label" for="variant-${k}-description">Description</label>
                        <textarea class="form-input" id="variant-${k}-description" rows="3"></textarea>
                        <input type="number" class="form-input" id="variant-${k}-allocation" min="0" max="100" step="1" placeholder="0-100">
                        <div class="form-error" id="variant-${k}-allocation-error" style="display:none;">Enter a valid number 0-100</div>
                    </div>
                </div>`;
            }
            window.addVariant = function(evt) {
                if (evt) {
                    if (typeof evt.preventDefault === 'function') evt.preventDefault();
                    if (typeof evt.stopPropagation === 'function') evt.stopPropagation();
                    if (typeof evt.stopImmediatePropagation === 'function') evt.stopImmediatePropagation();
                }
                const list = document.querySelector('.variants-list');
                if (!list) return;
                const domKeys = computeVariantKeysFromDOM();
                const configKeys = getConfigVariantKeys();
                const allKeys = Array.from(new Set([].concat(configKeys, domKeys)));
                const k = nextVariantKey(allKeys);
                if (!k) { alert('Maximum of 10 variants reached'); return; }
                const labelText = `Variant ${k}`;
                const html = createVariantRowHTML(k, labelText);
                const tmp = document.createElement('div'); tmp.innerHTML = html.trim();
                const node = tmp.firstElementChild; if (!node) return;
                // Mark this as a new unsaved variant
                node.setAttribute('data-unsaved', 'true');
                list.appendChild(node);
                // Ensure Edit Mode view for the new row
                const editGroup = document.getElementById(`variant-${k}-edit-fields`);
                const descStatic = document.getElementById(`variant-${k}-description-static`);
                const allocStatic = document.getElementById(`variant-${k}-allocation-static`);
                if (editGroup) editGroup.style.display = '';
                if (descStatic) descStatic.style.display = 'none';
                if (allocStatic) allocStatic.style.display = 'none';
                const descInput = document.getElementById(`variant-${k}-description`);
                const allocInput = document.getElementById(`variant-${k}-allocation`);
                if (descInput) descInput.value = '';
                if (allocInput) allocInput.value = '0';
            }

            });

            // Section toggle for sections that have it
            document.querySelectorAll('.section-header:not(.no-toggle)').forEach(header => {
                header.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = header.parentElement;
                    const sectionName = section.dataset.section;
                    if (sectionName) {
                        toggleSection(sectionName);
                    }
                });
            });

            // Window resize event to maintain height matching
            window.addEventListener('resize', () => {
                setTimeout(matchPieChartHeight, 100);
            });
        }

        function setupWorkflowButtons() {
            const approveBtn = document.getElementById('approve-btn');
            const webCard = document.getElementById('web-card');
            const androidCard = document.getElementById('android-card');
            const iosCard = document.getElementById('ios-card');

            // Approve button click handler
            approveBtn.addEventListener('click', function() {
                if (workflowStage === 'review') {
                    // Change button to show approved text with timestamp
                    const now = new Date();
                    const timestamp = now.toLocaleDateString('en-US', {
                        month: '2-digit',
                        day: '2-digit',
                        year: '2-digit'
                    });

                    // Replace button with greyed out text
                    const approvedText = document.createElement('span');
                    approvedText.textContent = `APPROVED ON ${timestamp}`;
                    approvedText.style.color = 'var(--text-secondary)';
                    approvedText.style.fontSize = '13px';
                    approvedText.style.fontWeight = '500';
                    approvedText.style.textTransform = 'uppercase';
                    approvedText.style.letterSpacing = '0.5px';

                    approveBtn.parentNode.replaceChild(approvedText, approveBtn);

                    // Update all platform cards to show Start buttons
                    updatePlatformCardStatus(webCard, 'start');
                    updatePlatformCardStatus(androidCard, 'start');
                    updatePlatformCardStatus(iosCard, 'start');

                    workflowStage = 'approved';
                }
            });

            // Add click handlers to platform cards for Start/Stop buttons
            setupPlatformCardHandlers(webCard, 'web');
            setupPlatformCardHandlers(androidCard, 'android');
            setupPlatformCardHandlers(iosCard, 'ios');
        }

        // Initialize default spaces (three common defaults) if none set
        function initializeDefaultSpaces() {
            try {
                const defaults = ['Home', 'Search', 'Category'];
                if (!Array.isArray(abacusConfig.selectedSpaces) || abacusConfig.selectedSpaces.length === 0) {
                    abacusConfig.selectedSpaces = defaults.slice();
                    if (typeof renderSpacesBubbleTags === 'function') renderSpacesBubbleTags();
                } else {
                    if (typeof renderSpacesBubbleTags === 'function') renderSpacesBubbleTags();
                }
            } catch (e) { console.warn('Default spaces init failed', e); }
        }


        // UPDATED: Platform card handlers with new workflow
        function setupPlatformCardHandlers(card, platform) {
            card.addEventListener('click', function(e) {


                const button = e.target.closest('.status-btn');
                const selectWinnerBtn = e.target.closest('.select-winner-btn');
                const winnerDisplay = e.target.closest('.winner-display');

                if (button && button.classList.contains('status-btn-start')) {
                    // Change Start to Stop
                    updatePlatformCardStatus(card, 'stop');
                } else if (button && button.classList.contains('status-btn-stop')) {
                    // NEW: Change Stop to Ended with select winner button
                    updatePlatformCardStatus(card, 'ended');
                } else if (selectWinnerBtn) {
                    // NEW: Show variant selection modal
                    e.stopPropagation();
                    showVariantSelectionModal(card, platform);
                } else if (winnerDisplay) {
                    // Allow re-selection of winner
                    e.stopPropagation();
                    showVariantSelectionModal(card, platform);
                }
            });
        }

        // UPDATED: Platform card status function with new states
        function updatePlatformCardStatus(card, status) {
            const statusElement = card.querySelector('.status-in-review-label, .status-btn, .ended-status-container, .winner-selected-container');

            if (status === 'start') {
                statusElement.outerHTML = '<button class="status-btn status-btn-start">Start</button>';
            } else if (status === 'stop') {
                statusElement.outerHTML = '<button class="status-btn status-btn-stop">Stop</button>';
            } else if (status === 'ended') {
                // NEW: Show ended state with select winner button
                statusElement.outerHTML = `
                    <div class="ended-status-container">
                        <div class="ended-status-label">Ended</div>
                        <button class="select-winner-btn">Select Winning Variant</button>
                    </div>
                `;
            } else if (status === 'winner-selected') {
                // NEW: Show winner selected state
                const winnerData = card.dataset.selectedWinner || 'B';

                statusElement.outerHTML = `
                    <div class="winner-selected-container">
                        <div class="winner-selected-label">Winner Selected</div>
                        <div class="winner-display">
                            <div class="winner-badge">${winnerData}</div>
                            <div class="winner-text">${variantLabels[winnerData]}</div>
                        </div>
                    </div>
                `;
            }

            // Re-setup event handlers after DOM change
            setupPlatformCardHandlers(card, card.id.split('-')[0]);
        }

        // NEW: Show variant selection modal
        function showVariantSelectionModal(card, platform) {
            const modal = document.getElementById('variant-selection-modal');
            setupVariantSelectionContent(modal, card, platform);
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // NEW: Setup variant selection modal content
        function setupVariantSelectionContent(modal, card, platform) {
            const variants = {
                'A': {
                    label: 'A — Current add to cart experience',
                    description: 'Standard add to cart experience when browsing products from search results.',
                    color: '#ff6b6b'
                },
                'B': {
                    label: 'B — New 1ATC experience',
                    description: 'One-click add to cart functionality when browsing products from search results.',
                    color: '#4ecdc4',
                    recommended: true // NEW: Mark as recommended
                },
                'C': {
                    label: 'C — Enhanced 1ATC with quantity selector',
                    description: 'One-click add to cart with inline quantity selector from search results.',
                    color: '#9b59b6'
                }
            };

            const recommendedVariant = Object.keys(variants).find(v => variants[v].recommended) || 'B';
            let selectedVariant = recommendedVariant; // Auto-select recommended

            const content = modal.querySelector('.variant-override-content');
            content.innerHTML = `
                <div class="recommended-variant-info">
                    <h4>
                        <svg class="recommended-icon" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0l2.5 5 5.5.5-4 4 1 5.5L8 12l-5 2.5 1-5.5-4-4L5.5 5 8 0z"/>
                        </svg>
                        Recommended Winner
                    </h4>
                    <p>Based on performance data, Variant ${recommendedVariant} is recommended as the winning variant.</p>
                </div>

                <h4 style="margin-bottom: 16px; color: var(--text-primary); font-size: 16px; font-weight: 600;">Select Winning Variant</h4>

                <div class="variant-options">
                    ${Object.keys(variants).map(variant => `
                        <div class="variant-option ${variant === recommendedVariant ? 'recommended selected' : ''}" data-variant="${variant}">
                            ${variant === recommendedVariant ? '<div class="recommended-badge">Recommended</div>' : ''}
                            <div class="variant-radio"></div>
                            <div class="variant-details">
                                <div class="variant-label">${variants[variant].label}</div>
                                <div class="variant-description">${variants[variant].description}</div>
                            </div>
                            <div class="variant-badge" style="background: ${variants[variant].color}">${variant}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="modal-actions">
                    <button class="modal-btn modal-btn-secondary" id="cancel-variant-selection">Cancel</button>
                    <button class="modal-btn modal-btn-primary" id="confirm-variant-selection">Select Winner</button>
                </div>
            `;

            // Add event listeners
            const variantOptions = content.querySelectorAll('.variant-option');
            const confirmButton = content.querySelector('#confirm-variant-selection');
            const cancelButton = content.querySelector('#cancel-variant-selection');

            variantOptions.forEach(option => {
                option.addEventListener('click', function() {
                    variantOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedVariant = this.dataset.variant;
                });
            });

            cancelButton.addEventListener('click', closeVariantSelectionModal);

            confirmButton.addEventListener('click', function() {
                if (selectedVariant) {
                    updateCardWithWinner(card, selectedVariant);
                    closeVariantSelectionModal();
                }
            });
        }

        // NEW: Update card with selected winner
        function updateCardWithWinner(card, winner) {
            card.dataset.selectedWinner = winner;
            updatePlatformCardStatus(card, 'winner-selected');
        }

        // NEW: Close variant selection modal
        function closeVariantSelectionModal() {
            const modal = document.getElementById('variant-selection-modal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        function switchEnvironment(environment) {
            // Update active environment tab
            document.querySelectorAll('.environment-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-environment="${environment}"]`).classList.add('active');

            // Update environment tab content
            document.querySelectorAll('.environment-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${environment}-content`).classList.add('active');
        }

        function switchTab(tabName) {
            if (tabName === currentTab) return;

            // Update active tab
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            currentTab = tabName;

            // Resources tab: ensure tag list is rendered
            if (tabName === 'resources' && typeof renderTargetingUrlsBubbleTags === 'function') {
                renderTargetingUrlsBubbleTags();
            }

            // Initialize charts when switching to tabs that contain them
            if (tabName === 'configuration' || tabName === 'results') {
                setTimeout(() => {
                    if (!variantsPieChart && tabName === 'configuration') {
                        initCharts();
                    }
                    if (!reportingChart && tabName === 'results') {
                        initReportingChart();
                    }
                    matchPieChartHeight();
                }, 100);
            }
            // Update actions visibility based on active tab
            if (typeof updateTabActionsVisibility === 'function') updateTabActionsVisibility();

        }


        function setupBannerToggle() {
            const allBannersCheckbox = document.getElementById('all-banners');
            const individualBanners = document.querySelector('.individual-banners');
            const individualCheckboxes = document.querySelectorAll('.individual-banner');

            if (!allBannersCheckbox) return;

            // When "All Banners" is toggled
            allBannersCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    individualBanners.classList.add('hidden');
                    // Check all individual banners when "All Banners" is checked
                    individualCheckboxes.forEach(cb => cb.checked = true);
                } else {
                    individualBanners.classList.remove('hidden');
                }
            });

            // When individual banners are toggled
            individualCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const allChecked = Array.from(individualCheckboxes).every(cb => cb.checked);

                    if (allChecked) {
                        // If all individual banners are checked, check "All Banners" and hide individuals
                        allBannersCheckbox.checked = true;
                        individualBanners.classList.add('hidden');
                    } else {
                        // If not all are checked, ensure "All Banners" is unchecked
                        allBannersCheckbox.checked = false;
                    }
                });
            });
        }

        function setupSubscriptionToggle() {
            const heartSection = document.getElementById('heart-toggle');
            const subscribersButton = document.getElementById('subscribers-button');
            const subscriberCountEl = document.getElementById('subscriber-count');
            const tooltip = document.querySelector('.subscription-tooltip');
            let isSubscribed = false;
            let currentCount = 12;

            // Sample subscribers data
            const subscribersData = [
                { name: 'Alex Rodriguez', role: 'Product Manager', initials: 'AR', date: '2 days ago' },
                { name: 'Jordan Kim', role: 'Senior Developer', initials: 'JK', date: '3 days ago' },
                { name: 'Taylor Walsh', role: 'UX Designer', initials: 'TW', date: '5 days ago' },
                { name: 'Morgan Chen', role: 'QA Engineer', initials: 'MC', date: '1 week ago' },
                { name: 'Casey Thompson', role: 'Data Analyst', initials: 'CT', date: '1 week ago' },
                { name: 'Riley Martinez', role: 'Frontend Developer', initials: 'RM', date: '2 weeks ago' },
                { name: 'Avery Parker', role: 'Product Owner', initials: 'AP', date: '2 weeks ago' },
                { name: 'Quinn Foster', role: 'Marketing Manager', initials: 'QF', date: '3 weeks ago' },
                { name: 'Sage Williams', role: 'Business Analyst', initials: 'SW', date: '3 weeks ago' },
                { name: 'Drew Mitchell', role: 'DevOps Engineer', initials: 'DM', date: '1 month ago' },
                { name: 'Emery Davis', role: 'Research Lead', initials: 'ED', date: '1 month ago' },
                { name: 'Phoenix Lee', role: 'Technical Writer', initials: 'PL', date: '2 months ago' }
            ];

            // Heart icon click - subscription toggle
            heartSection.addEventListener('click', function(e) {
                e.stopPropagation();
                isSubscribed = !isSubscribed;

                const subscriberPill = heartSection.closest('.subscriber-pill');

                if (isSubscribed) {
                    subscriberPill.classList.add('subscribed');
                    tooltip.textContent = 'Unsubscribe from notifications';
                    currentCount++;
                } else {
                    subscriberPill.classList.remove('subscribed');
                    tooltip.textContent = 'Subscribe to get notifications';
                    currentCount--;
                }

                subscriberCountEl.textContent = currentCount;
            });

            // Subscribers text click - show popup
            subscribersButton.addEventListener('click', function(e) {
                e.stopPropagation();
                showSubscribersModal();
            });

            function showSubscribersModal() {
                // Create modal if it doesn't exist
                let modal = document.getElementById('subscribers-modal');
                if (!modal) {
                    modal = createSubscribersModal();
                    document.body.appendChild(modal);
                }

                // Update subscriber count in modal
                const modalTitle = modal.querySelector('.subscribers-modal-title');
                modalTitle.textContent = `${currentCount} Subscribers`;

                // Populate subscribers list
                const subscribersList = modal.querySelector('.subscribers-list');
                subscribersList.innerHTML = subscribersData.map(subscriber => `
                    <div class="subscriber-item">
                        <div class="subscriber-avatar">${subscriber.initials}</div>
                        <div class="subscriber-details">
                            <div class="subscriber-name">${subscriber.name}</div>
                            <div class="subscriber-role">${subscriber.role}</div>
                        </div>
                        <div class="subscriber-date">${subscriber.date}</div>
                    </div>
                `).join('');

                // Show modal
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            function createSubscribersModal() {
                const modal = document.createElement('div');
                modal.id = 'subscribers-modal';
                modal.className = 'subscribers-modal';
                modal.innerHTML = `
                    <div class="subscribers-modal-content">
                        <div class="subscribers-modal-header">
                            <h3 class="subscribers-modal-title">12 Subscribers</h3>
                            <button class="subscribers-modal-close" id="close-subscribers-modal">×</button>
                        </div>
                        <div class="subscribers-list"></div>
                    </div>
                `;

                // Close modal functionality
                const closeButton = modal.querySelector('#close-subscribers-modal');
                closeButton.addEventListener('click', closeModal);

                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                function closeModal() {
                    modal.classList.remove('show');
                    document.body.style.overflow = '';
                }

                // ESC key to close modal
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.classList.contains('show')) {
                        closeModal();
                    }
                });

                return modal;
            }
        }

        function switchPlatform(platform) {
            if (platform === currentPlatform) return;

            // Update active platform chip
            document.querySelectorAll('.platform-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            document.querySelector(`[data-platform="${platform}"]`).classList.add('active');

            // Update audit log title
            const auditLogTitle = document.getElementById('audit-log-title');
            if (auditLogTitle) {
                auditLogTitle.textContent = `Audit Log for ${platform.toUpperCase()} experiment`;
            }

            // Update reporting title
            const reportingTitle = document.getElementById('reporting-title');
            if (reportingTitle) {
                reportingTitle.textContent = `Results for ${platform.toUpperCase()}`;
            }

            currentPlatform = platform;
            updatePlatformSpecificContent();
        }

        function updatePlatformSpecificContent() {
            // Update reporting chart
            if (reportingChart) {
                updateChart();
            }

            // Update audit log
            updateAuditLog();
        }

        function toggleSection(sectionName) {
            sectionStates[sectionName] = !sectionStates[sectionName];
            updateSectionStates();
        }

        function toggleTask(checkbox) {
            const isChecked = checkbox.classList.contains('checked');
            const taskItem = checkbox.closest('.checklist-task-item');

            if (!isChecked) {
                checkbox.classList.add('checked');
                checkbox.innerHTML = '✓';
                taskItem.classList.remove('required');
                taskItem.classList.add('completed');

                // Update status
                const status = taskItem.querySelector('.task-status');
                status.textContent = 'Completed';
                status.className = 'task-status status-completed';

                // Add signed off by
                const details = taskItem.querySelector('.task-details');
                const currentDate = new Date().toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                });
                const currentTime = new Date().toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });

                details.innerHTML += `<div class="signed-off-by">✓ Completed on ${currentDate}, ${currentTime}</div>`;
            }
        }

        function updateSectionStates() {
            Object.keys(sectionStates).forEach(sectionName => {
                const sections = document.querySelectorAll(`[data-section="${sectionName}"]`);
                sections.forEach(section => {
                    if (sectionStates[sectionName]) {
                        section.classList.add('expanded');
                    } else {
                        section.classList.remove('expanded');
                    }
                });
            });
        }

        function initCharts() {
            // Initialize Pie Chart for Variants (only if we're on configuration tab)
            const pieCtx = document.getElementById('variantsPieChart');
            if (pieCtx && !variantsPieChart) {
                variantsPieChart = new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Variant A', 'Variant B', 'Variant C'],
                        datasets: [{
                            data: [20, 40, 40],
                            backgroundColor: ['#ff6b6b', '#4ecdc4', '#9b59b6'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                align: 'start',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    font: {
                                        size: 12
                                    },
                                    color: '#2c3e50',
                                    textAlign: 'left',
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        if (data.labels.length && data.datasets.length) {
                                            return data.labels.map((label, i) => {
                                                const dataset = data.datasets[0];
                                                // Fixed character limit with ellipsis
                                                const maxChars = 28;
                                                let truncatedLabel = label.length > maxChars ?
                                                    label.substring(0, maxChars) + '...' :
                                                    label;

                                                return {
                                                    text: truncatedLabel,
                                                    fillStyle: dataset.backgroundColor[i],
                                                    strokeStyle: dataset.borderColor,
                                                    lineWidth: dataset.borderWidth,
                                                    pointStyle: 'circle',
                                                    hidden: false
                                                };
                                            });
                                        }
                                        return [];
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                },
                                bodyFont: {
                                    size: 13
                                },
                                padding: 12,
                                cornerRadius: 6,
                                displayColors: true,
                                boxWidth: 12,
                                boxHeight: 12
                            }
                        }
                    }
                });

                // Match pie chart height after charts are initialized
                setTimeout(matchPieChartHeight, 100);
            }

            // Initialize Reporting Chart (only if we're on results tab)
            initReportingChart();
        }

        function initReportingChart() {
            const ctx = document.getElementById('reportingChart');
            if (ctx && !reportingChart) {
                const data = platformData[currentPlatform].reporting;

                reportingChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date.substring(5)),
                        datasets: [{
                            label: 'Variant A',
                            data: data.map(d => d.variant1),
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#dc2626',
                            pointBorderColor: '#dc2626',
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }, {
                            label: 'Variant B',
                            data: data.map(d => d.variant2),
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#16a34a',
                            pointBorderColor: '#16a34a',
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }, {
                            label: 'Variant C',
                            data: data.map(d => d.variant3),
                            borderColor: '#9333ea',
                            backgroundColor: 'rgba(147, 51, 234, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#9333ea',
                            pointBorderColor: '#9333ea',
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#2c3e50'
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#6c757d'
                                },
                                grid: {
                                    color: '#e9ecef'
                                }
                            },
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    },
                                    color: '#6c757d'
                                },
                                grid: {
                                    color: '#e9ecef'
                                }
                            }
                        },
                        elements: {
                            point: {
                                hoverRadius: 8
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
        }

        function updateChart() {
            if (!reportingChart) return;

            const data = platformData[currentPlatform].reporting;
            reportingChart.data.labels = data.map(d => d.date.substring(5));
            reportingChart.data.datasets[0].data = data.map(d => d.variant1);
            reportingChart.data.datasets[1].data = data.map(d => d.variant2);
            reportingChart.data.datasets[2].data = data.map(d => d.variant3);

            // Ensure colors are maintained
            reportingChart.data.datasets[0].borderColor = '#dc2626';
            reportingChart.data.datasets[0].backgroundColor = 'rgba(220, 38, 38, 0.1)';
            reportingChart.data.datasets[0].pointBackgroundColor = '#dc2626';
            reportingChart.data.datasets[0].pointBorderColor = '#dc2626';

            reportingChart.data.datasets[1].borderColor = '#16a34a';
            reportingChart.data.datasets[1].backgroundColor = 'rgba(22, 163, 74, 0.1)';
            reportingChart.data.datasets[1].pointBackgroundColor = '#16a34a';
            reportingChart.data.datasets[1].pointBorderColor = '#16a34a';

            reportingChart.data.datasets[2].borderColor = '#9333ea';
            reportingChart.data.datasets[2].backgroundColor = 'rgba(147, 51, 234, 0.1)';
            reportingChart.data.datasets[2].pointBackgroundColor = '#9333ea';
            reportingChart.data.datasets[2].pointBorderColor = '#9333ea';

            reportingChart.update();
        }

        function updateAuditLog() {
            const auditContent = document.querySelector('#audit-tab .section-content');
            if (!auditContent) return;

            const auditData = platformData[currentPlatform].audit;

            auditContent.innerHTML = auditData.map(item => `
                <div class="audit-item">
                    <div class="audit-header">
                        <div class="audit-user">${item.user}</div>
                        <div class="audit-date">${item.date}</div>
                    </div>
                    <div class="audit-changes">${item.changes.replace(/\n/g, '<br>')}</div>
                </div>
            `).join('');
        }


        // Spaces (multi-select dropdown + bubble tags)
        const predefinedSpaces = [
            'Home', 'Search', 'Category', 'Product Details', 'Cart', 'Checkout', 'Account',
            'Recommendations', 'Deals', 'Store Locator', 'Weekly Ad', 'Order History'
        ];
        function renderSpaceOptions() {
            const select = document.getElementById('spaces-select');
            if (!select) return;
            const selected = abacusConfig.selectedSpaces || [];
            const options = ['<option value="">Select Space...</option>'];
            predefinedSpaces.forEach(name => {
                if (!selected.includes(name)) options.push(`<option value="${name}">${name}</option>`);
            });
            select.innerHTML = options.join('');
            select.disabled = options.length <= 1; // only placeholder remains
        }
        function renderSpacesBubbleTags() {
            const container = document.getElementById('spaces-tags');
            if (!container) return;
            const spaces = abacusConfig.selectedSpaces || [];
            container.innerHTML = (spaces || []).map(s => {
                const removeBtn = isReadOnlyMode ? '' : `<button type="button" data-space="${s}" onclick="removeSpace(this.dataset.space)" style="margin-left:6px;background:transparent;border:none;color:#fff;cursor:pointer;font-weight:700;">\u00D7</button>`;
                return `
                <span style="display:inline-flex;align-items:center;background:var(--accent-blue);color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;margin:2px;">
                    <span>${s}</span>
                    ${removeBtn}
                </span>`;
            }).join('');
            renderSpaceOptions();
        }
        function addSpace(name) {
            const value = (name || '').trim();
            if (!value) return;
            abacusConfig.selectedSpaces = abacusConfig.selectedSpaces || [];
            if (!abacusConfig.selectedSpaces.includes(value)) {
                abacusConfig.selectedSpaces.push(value);
            }
            renderSpacesBubbleTags();
        }
        function removeSpace(name) {
            abacusConfig.selectedSpaces = (abacusConfig.selectedSpaces || []).filter(s => s !== name);
            renderSpacesBubbleTags();
        }
        function handleSpaceSelect(value) {
            if (!value) return;
            addSpace(value);
        }

        // Modal event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal on outside click
            document.getElementById('variant-selection-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeVariantSelectionModal();
                }
            });

            // Close modal on X click
            document.getElementById('close-variant-modal').addEventListener('click', closeVariantSelectionModal);

            // Close modal on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeVariantSelectionModal();
                }
            });

            // Initialize when DOM is loaded
            init();
        });

        // Make functions globally accessible for onclick handlers
        window.toggleTask = toggleTask;
        window.enterEditMode = enterEditMode;
        window.enterReadMode = enterReadMode;
        window.saveEdits = saveEdits;
        window.cancelEdits = cancelEdits;
        window.renderBannersBubbleTags = renderBannersBubbleTags;
        window.renderSecondaryMetricsBubbleTags = renderSecondaryMetricsBubbleTags;
        window.renderSpacesBubbleTags = renderSpacesBubbleTags;


    </script>
</body>
</html>
